<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å Solve</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937, #111827); /* –¢–µ–º–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .calculator {
            background: #374151; /* –¢–µ–º–Ω—ã–π —Å–µ—Ä—ã–π */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 95%;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #4b5563;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–ø—É—Ç–æ–≤ */
        input[type="text"] {
            width: 100%;
            font-size: 1.5rem;
            margin-bottom: 15px;
            border: none;
            border-radius: 8px;
            padding: 15px;
            box-sizing: border-box;
            background: #1f2937; /* –û—á–µ–Ω—å —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π */
            color: #d1d5db; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
            text-align: right;
            transition: all 0.2s;
        }
        input[type="text"]:focus {
            outline: none;
            box-shadow: 0 0 0 3px #10b981; /* –ó–µ–ª–µ–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
        }
        
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        button {
            padding: 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 3px #4b5563;
            cursor: pointer;
            user-select: none;
        }

        /* –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ */
        .btn-op {
            background-color: #f59e0b; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
            color: #1f2937;
            box-shadow: 0 3px #d97706;
        }
        .btn-op:active { background-color: #d97706; transform: translateY(1px); box-shadow: 0 2px #d97706; }

        /* –ß–∏—Å–ª–∞ */
        .btn-num {
            background-color: #4b5563; /* –°—Ä–µ–¥–Ω–∏–π —Å–µ—Ä—ã–π */
            color: white;
            box-shadow: 0 3px #374151;
        }
        .btn-num:active { background-color: #374151; transform: translateY(1px); box-shadow: 0 2px #374151; }

        /* –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .btn-equals, .btn-solve {
            background-color: #10b981; /* –ó–µ–ª–µ–Ω—ã–π */
            color: white;
            box-shadow: 0 3px #059669;
        }
        .btn-equals:active, .btn-solve:active { background-color: #059669; transform: translateY(1px); box-shadow: 0 2px #059669; }

        /* –û—á–∏—Å—Ç–∫–∞ */
        .btn-clear {
            background-color: #ef4444; /* –ö—Ä–∞—Å–Ω—ã–π */
            color: white;
            box-shadow: 0 3px #dc2626;
        }
        .btn-clear:active { background-color: #dc2626; transform: translateY(1px); box-shadow: 0 2px #dc2626; }
        
        .result-box {
            margin-top: 20px;
            min-height: 40px;
            padding: 10px;
            border-radius: 8px;
            font-size: 1.25rem;
            text-align: left;
            word-break: break-all;
            background-color: #1f2937;
            color: #10b981;
        }
        .error { color: #f87171; }
    </style>
</head>
<body>
    <div class="calculator">
        <h1 class="text-3xl font-extrabold text-white mb-6 text-center">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>

        <!-- –ë–ª–æ–∫ –≤–≤–æ–¥–∞ -->
        <input type="text" id="expression" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (2+2) –∏–ª–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ (2x=4)">
        
        <!-- –ë–ª–æ–∫ –≤—ã–≤–æ–¥–∞ -->
        <div class="result-box" id="result">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...</div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="space-y-4 mt-6">
            <div class="grid grid-cols-5 gap-2">
                <button class="btn-op text-sm" onclick="appendToExpression('Math.sin(')">sin</button>
                <button class="btn-op text-sm" onclick="appendToExpression('Math.cos(')">cos</button>
                <button class="btn-op text-sm" onclick="appendToExpression('Math.tan(')">tan</button>
                <button class="btn-op text-sm" onclick="appendToExpression('Math.log(')">ln</button>
                <button class="btn-op text-sm" onclick="appendToExpression('Math.sqrt(')">‚àö</button>
            </div>
            
            <div class="btn-grid">
                <button class="btn-clear" onclick="clearExpression()">C</button>
                <button class="btn-op" onclick="appendToExpression('(')">(</button>
                <button class="btn-op" onclick="appendToExpression(')')">)</button>
                <button class="btn-op" onclick="appendToExpression('/')">/</button>

                <button class="btn-num" onclick="appendToExpression('7')">7</button>
                <button class="btn-num" onclick="appendToExpression('8')">8</button>
                <button class="btn-num" onclick="appendToExpression('9')">9</button>
                <button class="btn-op" onclick="appendToExpression('*')">√ó</button>

                <button class="btn-num" onclick="appendToExpression('4')">4</button>
                <button class="btn-num" onclick="appendToExpression('5')">5</button>
                <button class="btn-num" onclick="appendToExpression('6')">6</button>
                <button class="btn-op" onclick="appendToExpression('-')">-</button>

                <button class="btn-num" onclick="appendToExpression('1')">1</button>
                <button class="btn-num" onclick="appendToExpression('2')">2</button>
                <button class="btn-num" onclick="appendToExpression('3')">3</button>
                <button class="btn-op" onclick="appendToExpression('+')">+</button>
                
                <button class="btn-num" onclick="appendToExpression('0')">0</button>
                <button class="btn-num" onclick="appendToExpression('.')">.</button>
                <button class="btn-num" onclick="appendToExpression('Math.PI')">œÄ</button>
                <button class="btn-num" onclick="appendToExpression('^')">^</button>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mt-4">
                <button class="btn-equals" onclick="handleInput()">= –í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <button class="btn-solve" onclick="handleInput()">Solve</button>
            </div>
        </div>
        
        <p class="text-xs text-gray-400 mt-4 text-center">
            *–î–ª—è —Ä–µ—à–µ–Ω–∏—è —É—Ä–∞–≤–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: <code>2x + 5 = 15</code> (–ª–∏–Ω–µ–π–Ω—ã–µ) –∏–ª–∏ <code>x^2 - 4 = 0</code> (–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—ã–µ).
        </p>
    </div>

    <script>
        const expressionInput = document.getElementById('expression');
        const resultDiv = document.getElementById('result');

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter
        expressionInput.addEventListener('keypress', function(e) { 
            if (e.key === 'Enter') handleInput(); 
        });

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---

        // –§–∞–∫—Ç–æ—Ä–∏–∞–ª
        function factorial(n) {
            n = Math.floor(n);
            if (n < 0) throw new Error('–§–∞–∫—Ç–æ—Ä–∏–∞–ª –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω.');
            if (n === 0 || n === 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) result *= i;
            return result;
        }

        // –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–ª–∏ –æ—à–∏–±–∫–∏
        function showResult(text, isError = false) {
            resultDiv.textContent = text;
            resultDiv.className = 'result-box ' + (isError ? 'error' : 'text-emerald-400');
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        function appendToExpression(value) {
            expressionInput.value += value;
            expressionInput.focus();
        }

        // –û—á–∏—Å—Ç–∫–∞
        function clearExpression() {
            expressionInput.value = '';
            showResult('–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...');
        }

        // --- –ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ ---

        function handleInput() {
            const input = expressionInput.value.trim();
            if (!input) {
                showResult('–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ!', true);
                return;
            }

            if (input.includes('=')) {
                solveEquation(input);
            } else {
                calculateBasic(input);
            }
        }

        // --- 1. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è ---

        function calculateBasic(expr) {
            try {
                // 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: –ó–∞–º–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞
                let safeExpr = expr.replace(/\^/g, '**') // a^b -> a**b (power)
                                   .replace(/(\d+)!/g, 'factorial($1)') // 5! -> factorial(5)
                                   // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—è–≤–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2pi)
                                   .replace(/([0-9\.]+)([A-Za-z])/g, '$1*$2')
                                   .replace(/\)([0-9])/g, ')*$1');

                // 2. –í–∞–π—Ç–ª–∏—Å—Ç (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å): –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, Math.*, –∏ 'factorial'
                const allowedCode = safeExpr.replace(/Math\.(sin|cos|tan|log|sqrt|PI|E|pow|abs|round|floor|ceil|random)|\d+\.?\d*|[\+\-\*\/\(\)\s\**]|factorial/g, '');

                if (allowedCode.length > 0) {
                    throw new Error('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏: ' + allowedCode.trim().substring(0, 10) + '...');
                }

                // 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é Function (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º eval)
                // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é factorial –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
                const func = new Function('factorial', 'return ' + safeExpr);
                const result = func(factorial);

                if (isNaN(result) || !isFinite(result)) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.');
                }
                showResult(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.toFixed(10).replace(/\.?0+$/, '')}`);
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è: ' + error.message, true);
            }
        }

        // --- 2. –†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π ---

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (ax + b)
        function parseSide(expr) {
            let coeffX = 0;
            let constant = 0;

            // –£–ø—Ä–æ—â–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–≤–æ–¥
            expr = expr.replace(/\s/g, '');
            
            // –ó–∞–º–µ–Ω–∞ 'x' –Ω–∞ '1x' –∏–ª–∏ '-x' –Ω–∞ '-1x' –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
            expr = expr.replace(/([+-]|^)x/g, '$11x');
            expr = expr.replace(/^x/, '1x');
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —á–ª–µ–Ω—ã: 2x, -5, +3x, -10, x^2 –∏ —Ç.–¥.
            const terms = expr.match(/([+-]?\d*\.?\d*\^2x?)|([+-]?\d*\.?\d*x)|([+-]?\d+\.?\d*)/g);
            
            let coeffA = 0; // x^2
            let coeffB = 0; // x
            let coeffC = 0; // const

            if (!terms) return { coeffA: 0, coeffB: 0, coeffC: 0 };

            for (let term of terms) {
                if (term.includes('x^2')) {
                    // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–∏ x^2
                    let coeff = term.replace('x^2', '');
                    if (coeff === '+' || coeff === '') coeff = '1';
                    if (coeff === '-') coeff = '-1';
                    coeffA += parseFloat(coeff) || 0;
                } else if (term.includes('x')) {
                    // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–∏ x
                    let coeff = term.replace('x', '');
                    if (coeff === '+' || coeff === '') coeff = '1';
                    if (coeff === '-') coeff = '-1';
                    coeffB += parseFloat(coeff) || 0;
                } else if (term) {
                    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞
                    coeffC += parseFloat(term) || 0;
                }
            }
            return { coeffA, coeffB, coeffC };
        }


        function solveEquation(input) {
            try {
                const parts = input.split('=').map(p => p.trim());
                if (parts.length !== 2) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —É—Ä–∞–≤–Ω–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∑–Ω–∞–∫ "=".');
                
                const leftParsed = parseSide(parts[0]);
                const rightParsed = parseSide(parts[1]);

                // –ü—Ä–∏–≤–æ–¥–∏–º –∫ –æ–±—â–µ–º—É –≤–∏–¥—É: A x^2 + B x + C = 0
                const A = leftParsed.coeffA - rightParsed.coeffA;
                const B = leftParsed.coeffB - rightParsed.coeffB;
                const C = leftParsed.coeffC - rightParsed.coeffC;
                
                if (A === 0) {
                    // --- –õ–∏–Ω–µ–π–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: Bx + C = 0 ---
                    if (B === 0) {
                        showResult(C === 0 ? '–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ –º–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏–π (0 = 0)' : '–ù–µ—Ç —Ä–µ—à–µ–Ω–∏–π', C !== 0);
                    } else {
                        const x = -C / B;
                        showResult(`–õ–∏–Ω–µ–π–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: x = ${x.toFixed(6)}`);
                    }
                } else {
                    // --- –ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: Ax^2 + Bx + C = 0 ---
                    const discriminant = B * B - 4 * A * C;

                    if (discriminant < 0) {
                        // –î–ª—è –±–æ–ª—å—à–µ–π –ø–æ–ª—å–∑—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –∫–æ—Ä–Ω–∏
                        const realPart = (-B / (2 * A)).toFixed(6);
                        const imagPart = (Math.sqrt(-discriminant) / (2 * A)).toFixed(6);
                        showResult(`–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è: x1 = ${realPart} + ${imagPart}i, x2 = ${realPart} - ${imagPart}i`);
                    } else if (discriminant === 0) {
                        const x = -B / (2 * A);
                        showResult(`–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–æ–¥–∏–Ω –∫–æ—Ä–µ–Ω—å): x = ${x.toFixed(6)}`);
                    } else {
                        const x1 = (-B + Math.sqrt(discriminant)) / (2 * A);
                        const x2 = (-B - Math.sqrt(discriminant)) / (2 * A);
                        showResult(`–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è: x1 = ${x1.toFixed(6)}, x2 = ${x2.toFixed(6)}`);
                    }
                }

            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏—è: ' + error.message + '. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.', true);
            }
        }
    </script>
</body>
    </html>
