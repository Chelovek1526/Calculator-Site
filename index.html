<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å "AI"<title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            min-height: 100vh;
            padding: 20px;
            color: #f1f5f9;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }
        
        .ai-btn {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }
        
        .calculator {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .display-container {
            background: #0f172a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #334155;
        }
        
        .expression-display {
            font-size: 1.5rem;
            min-height: 35px;
            color: #cbd5e1;
            word-break: break-all;
            margin-bottom: 10px;
        }
        
        .result-display {
            font-size: 2.8rem;
            font-weight: 700;
            text-align: right;
            color: #10b981;
            min-height: 50px;
            word-break: break-all;
        }
        
        .input-field {
            width: 100%;
            padding: 18px;
            font-size: 1.4rem;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 12px;
            color: white;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        .btn {
            padding: 18px 10px;
            border-radius: 12px;
            border: none;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(110%);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-number {
            background: #334155;
            color: white;
        }
        
        .btn-operator {
            background: #f59e0b;
            color: #1e293b;
        }
        
        .btn-function {
            background: #3b82f6;
            color: white;
        }
        
        .btn-clear {
            background: #ef4444;
            color: white;
        }
        
        .btn-equals {
            background: #10b981;
            color: white;
            grid-column: span 2;
        }
        
        .btn-memory {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-scientific {
            background: #ec4899;
            color: white;
        }
        
        .memory-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .scientific-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .converter-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }
        
        .history-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #334155;
        }
        
        .history-item {
            background: #1e293b;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #f59e0b;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background: #334155;
            transform: translateX(5px);
        }
        
        .history-expr {
            color: #cbd5e1;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .history-result {
            color: #10b981;
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .converter-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .converter-input {
            width: 100%;
            padding: 15px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
        }
        
        .converter-select {
            width: 100%;
            padding: 15px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }
        
        .converter-result {
            background: #0f172a;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.8rem;
            color: #3b82f6;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
            border: 2px solid #334155;
        }
        
        .converter-arrow {
            font-size: 2rem;
            color: #f59e0b;
            text-align: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: #1e293b;
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .honest-badge {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: #1e293b;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .truth-box {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .ai-prompt {
            width: 100%;
            height: 120px;
            padding: 15px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        .ai-response {
            background: #0f172a;
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border-left: 4px solid #8b5cf6;
        }
        
        .ai-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .ai-action-btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }
        
        .copy-btn {
            background: #334155;
            color: white;
        }
        
        .insert-btn {
            background: #10b981;
            color: white;
        }
        
        .clear-btn {
            background: #ef4444;
            color: white;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: #1e293b;
            padding: 5px;
            border-radius: 12px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            color: #cbd5e1;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #8b5cf6;
            color: white;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #cbd5e1;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 5px;
        }
        
        @media (max-width: 600px) {
            .buttons-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .btn {
                padding: 16px 8px;
                font-size: 1.1rem;
            }
            
            .scientific-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .converter-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .converter-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä "–ß–µ—Å—Ç–Ω—ã–π"</h1>
            <button class="ai-btn" onclick="openModal('aiModal')">
                <i class="fas fa-robot"></i> "AI" –ü–æ–º–æ—â–Ω–∏–∫
            </button>
        </div>
        
        <div class="calculator">
            <div class="display-container">
                <div class="expression-display" id="expressionDisplay"></div>
                <div class="result-display" id="resultDisplay">0</div>
            </div>
            
            <input type="text" class="input-field" id="expressionInput" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: 100%50, x+5=10, 3/4*2" 
                   autocomplete="off" onkeydown="handleKeyDown(event)">
            
            <div class="memory-buttons">
                <button class="btn btn-memory" onclick="memoryClear()">MC</button>
                <button class="btn btn-memory" onclick="memoryRecall()">MR</button>
                <button class="btn btn-memory" onclick="memoryAdd()">M+</button>
                <button class="btn btn-memory" onclick="memorySubtract()">M-</button>
            </div>
            
            <div class="scientific-buttons">
                <button class="btn btn-scientific" onclick="appendToExpression('sin(')">sin</button>
                <button class="btn btn-scientific" onclick="appendToExpression('cos(')">cos</button>
                <button class="btn btn-scientific" onclick="appendToExpression('tan(')">tan</button>
                <button class="btn btn-scientific" onclick="appendToExpression('log(')">log</button>
                <button class="btn btn-scientific" onclick="appendToExpression('sqrt(')">‚àö</button>
                <button class="btn btn-scientific" onclick="appendToExpression('pi')">œÄ</button>
                <button class="btn btn-scientific" onclick="appendToExpression('e')">e</button>
                <button class="btn btn-scientific" onclick="appendToExpression('^')">^</button>
                <button class="btn btn-scientific" onclick="appendToExpression('!')">!</button>
                <button class="btn btn-scientific" onclick="appendToExpression('(')">(</button>
                <button class="btn btn-scientific" onclick="appendToExpression(')')">)</button>
            </div>
            
            <div class="buttons-grid">
                <button class="btn btn-clear" onclick="clearExpression()">AC</button>
                <button class="btn btn-function" onclick="toggleHistory()">
                    <i class="fas fa-history"></i>
                </button>
                <button class="btn btn-function" onclick="toggleConverter()">
                    <i class="fas fa-exchange-alt"></i>
                </button>
                <button class="btn btn-operator" onclick="appendToExpression('/')">√∑</button>
                
                <button class="btn btn-number" onclick="appendToExpression('7')">7</button>
                <button class="btn btn-number" onclick="appendToExpression('8')">8</button>
                <button class="btn btn-number" onclick="appendToExpression('9')">9</button>
                <button class="btn btn-operator" onclick="appendToExpression('*')">√ó</button>
                
                <button class="btn btn-number" onclick="appendToExpression('4')">4</button>
                <button class="btn btn-number" onclick="appendToExpression('5')">5</button>
                <button class="btn btn-number" onclick="appendToExpression('6')">6</button>
                <button class="btn btn-operator" onclick="appendToExpression('-')">-</button>
                
                <button class="btn btn-number" onclick="appendToExpression('1')">1</button>
                <button class="btn btn-number" onclick="appendToExpression('2')">2</button>
                <button class="btn btn-number" onclick="appendToExpression('3')">3</button>
                <button class="btn btn-operator" onclick="appendToExpression('+')">+</button>
                
                <button class="btn btn-number" onclick="appendToExpression('0')">0</button>
                <button class="btn btn-number" onclick="appendToExpression('.')">.</button>
                <button class="btn btn-function" onclick="appendToExpression('%')">%</button>
                <button class="btn btn-equals" onclick="calculate()">=</button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab" onclick="showTab('history')">üìú –ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="tab" onclick="showTab('converter')">üåê –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</button>
        </div>
        
        <div class="history-section" id="historySection">
            <div class="section-header">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π</h2>
                <button onclick="clearAllHistory()" class="btn btn-clear" style="padding: 8px 15px;">
                    –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
                </button>
            </div>
            <div id="historyList"></div>
        </div>
        
        <div class="converter-section" id="converterSection">
            <div class="section-header">
                <h2>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü</h2>
            </div>
            
            <div style="margin-bottom: 20px;">
                <select id="converterCategory" class="converter-select" onchange="updateConverterUnits()">
                    <option value="length">–î–ª–∏–Ω–∞</option>
                    <option value="mass">–ú–∞—Å—Å–∞</option>
                    <option value="temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="area">–ü–ª–æ—â–∞–¥—å</option>
                    <option value="volume">–û–±—ä—ë–º</option>
                    <option value="time">–í—Ä–µ–º—è</option>
                </select>
            </div>
            
            <div class="converter-row">
                <input type="number" id="converterValue" class="converter-input" value="1" oninput="convertUnits()">
                <select id="converterFrom" class="converter-select" onchange="convertUnits()"></select>
                <div class="converter-arrow">‚Üí</div>
                <select id="converterTo" class="converter-select" onchange="convertUnits()"></select>
            </div>
            
            <div class="converter-result" id="converterResult">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
        </div>
    </div>
    
    <!-- AI –ú–æ–¥–∞–ª–∫–∞ -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="font-size: 1.8rem;">üß† "AI" –ü–æ–º–æ—â–Ω–∏–∫ <span class="honest-badge">–ù–ê–Å–ë 9000</span></h2>
                <button class="close-btn" onclick="closeModal('aiModal')">√ó</button>
            </div>
            
            <div class="truth-box">
                <p>üé≠ <strong>–ß–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä—è:</strong> –≠—Ç–æ –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–π –ò–ò, –∞ –±–∞–∑–∞ –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.</p>
                <p style="margin-top: 5px; font-size: 0.9rem;">‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ ‚Ä¢ üîí –ë–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ ‚Ä¢ üí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
            </div>
            
            <textarea class="ai-prompt" id="aiPrompt" 
                      placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ:
‚Ä¢ 2+2
‚Ä¢ x+5=10  
‚Ä¢ 15% –æ—Ç 200
‚Ä¢ –ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5
‚Ä¢ —Ç–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞"></textarea>
            
            <button onclick="askAI()" class="ai-btn" style="width: 100%; justify-content: center;">
                <i class="fas fa-brain"></i> –ü–æ–ª—É—á–∏—Ç—å "AI" –æ—Ç–≤–µ—Ç
            </button>
            
            <div class="ai-response" id="aiResponse">
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ü§î</div>
                    <p>"AI" –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ä–µ–∂–∏–º–µ "–ß–µ—Å—Ç–Ω—ã–π –Ω–∞—ë–±"</p>
                    <p style="margin-top: 10px; color: #94a3b8;">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å - –ø–æ–ª—É—á–∏—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π!</p>
                </div>
            </div>
            
            <div class="ai-actions">
                <button class="ai-action-btn copy-btn" onclick="copyAIResponse()">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button class="ai-action-btn insert-btn" onclick="insertAIResult()">
                    <i class="fas fa-calculator"></i> –í –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                </button>
                <button class="ai-action-btn clear-btn" onclick="clearAIResponse()">
                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
            </div>
            
            <div style="margin-top: 20px; color: #94a3b8; font-size: 0.9rem;">
                <p>üí° <strong>–°–µ–∫—Ä–µ—Ç:</strong> –ë–∞–∑–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 150+ –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π. –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–∞–π—Ç–µ —á–µ—Ä–µ–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä!</p>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        let memoryValue = 0;
        let calculationHistory = [];
        let currentTab = 'history';
        let currentExpression = '';
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ math.js
        math.config({
            number: 'BigNumber',
            precision: 64
        });
        
        // –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π "AI"
        const mathKnowledgeBase = {
            // –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
            '2+2': '2 + 2 = 4',
            '3+3': '3 + 3 = 6',
            '4+4': '4 + 4 = 8',
            '5+5': '5 + 5 = 10',
            '10+10': '10 + 10 = 20',
            '100+100': '100 + 100 = 200',
            '1000+1000': '1000 + 1000 = 2000',
            '1+1': '1 + 1 = 2',
            '10-5': '10 - 5 = 5',
            '20-10': '20 - 10 = 10',
            '100-50': '100 - 50 = 50',
            '2*2': '2 √ó 2 = 4',
            '3*3': '3 √ó 3 = 9',
            '4*4': '4 √ó 4 = 16',
            '5*5': '5 √ó 5 = 25',
            '6*6': '6 √ó 6 = 36',
            '7*7': '7 √ó 7 = 49',
            '8*8': '8 √ó 8 = 64',
            '9*9': '9 √ó 9 = 81',
            '10*10': '10 √ó 10 = 100',
            '10/2': '10 √∑ 2 = 5',
            '20/4': '20 √∑ 4 = 5',
            '100/10': '100 √∑ 10 = 10',
            '1000/100': '1000 √∑ 100 = 10',
            
            // –£—Ä–∞–≤–Ω–µ–Ω–∏—è
            'x+5=10': 'x + 5 = 10\nx = 10 - 5\nx = 5',
            'x-3=7': 'x - 3 = 7\nx = 7 + 3\nx = 10',
            '2x=8': '2x = 8\nx = 8 √∑ 2\nx = 4',
            '3x=12': '3x = 12\nx = 12 √∑ 3\nx = 4',
            'x/2=6': 'x √∑ 2 = 6\nx = 6 √ó 2\nx = 12',
            'x^2=9': 'x¬≤ = 9\nx = ‚àö9\nx = 3 –∏–ª–∏ x = -3',
            'x^2=16': 'x¬≤ = 16\nx = ‚àö16\nx = 4 –∏–ª–∏ x = -4',
            'x^2=25': 'x¬≤ = 25\nx = ‚àö25\nx = 5 –∏–ª–∏ x = -5',
            
            // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
            '15% –æ—Ç 200': '15% –æ—Ç 200 = 200 √ó 0.15 = 30',
            '10% –æ—Ç 100': '10% –æ—Ç 100 = 100 √ó 0.10 = 10',
            '20% –æ—Ç 50': '20% –æ—Ç 50 = 50 √ó 0.20 = 10',
            '25% –æ—Ç 80': '25% –æ—Ç 80 = 80 √ó 0.25 = 20',
            '50% –æ—Ç 60': '50% –æ—Ç 60 = 60 √ó 0.50 = 30',
            '75% –æ—Ç 40': '75% –æ—Ç 40 = 40 √ó 0.75 = 30',
            '100% –æ—Ç 45': '100% –æ—Ç 45 = 45 √ó 1.00 = 45',
            '200% –æ—Ç 30': '200% –æ—Ç 30 = 30 √ó 2.00 = 60',
            
            // –ì–µ–æ–º–µ—Ç—Ä–∏—è
            '–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5': 'S = œÄr¬≤ = œÄ √ó 5¬≤ = 25œÄ ‚âà 78.54',
            '–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ r=3': 'S = œÄr¬≤ = œÄ √ó 3¬≤ = 9œÄ ‚âà 28.27',
            '–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ r=10': 'S = œÄr¬≤ = œÄ √ó 10¬≤ = 100œÄ ‚âà 314.16',
            '–ø–ª–æ—â–∞–¥—å –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å—Ç–æ—Ä–æ–Ω–æ–π 4': 'S = a¬≤ = 4¬≤ = 16',
            '–ø–ª–æ—â–∞–¥—å –∫–≤–∞–¥—Ä–∞—Ç–∞ a=5': 'S = a¬≤ = 5¬≤ = 25',
            '–ø–ª–æ—â–∞–¥—å –∫–≤–∞–¥—Ä–∞—Ç–∞ a=10': 'S = a¬≤ = 10¬≤ = 100',
            '–ø–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ 6x4': 'S = a √ó b = 6 √ó 4 = 24',
            '–ø–ª–æ—â–∞–¥—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ 6 –≤—ã—Å–æ—Ç–∞ 4': 'S = ¬Ω √ó –æ—Å–Ω–æ–≤–∞–Ω–∏–µ √ó –≤—ã—Å–æ—Ç–∞ = ¬Ω √ó 6 √ó 4 = 12',
            '–ø–µ—Ä–∏–º–µ—Ç—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å—Ç–æ—Ä–æ–Ω–æ–π 5': 'P = 4a = 4 √ó 5 = 20',
            '–æ–±—ä–µ–º –∫—É–±–∞ —Å—Ç–æ—Ä–æ–Ω–æ–π 3': 'V = a¬≥ = 3¬≥ = 27',
            '–æ–±—ä–µ–º –∫—É–±–∞ a=2': 'V = a¬≥ = 2¬≥ = 8',
            '–æ–±—ä–µ–º –∫—É–±–∞ a=4': 'V = a¬≥ = 4¬≥ = 64',
            
            // –¢–µ–æ—Ä–µ–º—ã –∏ —Ñ–æ—Ä–º—É–ª—ã
            '—Ç–µ–æ—Ä–µ–º–∞ –ø–∏—Ñ–∞–≥–æ—Ä–∞': 'a¬≤ + b¬≤ = c¬≤\n–ì–¥–µ c - –≥–∏–ø–æ—Ç–µ–Ω—É–∑–∞, a –∏ b - –∫–∞—Ç–µ—Ç—ã',
            '—Ñ–æ—Ä–º—É–ª–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è': 'ax¬≤ + bx + c = 0\nD = b¬≤ - 4ac\nx‚ÇÅ,‚ÇÇ = (-b ¬± ‚àöD) / 2a',
            '—Ñ–æ—Ä–º—É–ª–∞ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–∞': 'D = b¬≤ - 4ac',
            '—Å–∏–Ω—É—Å 30': 'sin(30¬∞) = 1/2 = 0.5',
            '—Å–∏–Ω—É—Å 45': 'sin(45¬∞) = ‚àö2/2 ‚âà 0.7071',
            '—Å–∏–Ω—É—Å 60': 'sin(60¬∞) = ‚àö3/2 ‚âà 0.8660',
            '—Å–∏–Ω—É—Å 90': 'sin(90¬∞) = 1',
            '–∫–æ—Å–∏–Ω—É—Å 30': 'cos(30¬∞) = ‚àö3/2 ‚âà 0.8660',
            '–∫–æ—Å–∏–Ω—É—Å 45': 'cos(45¬∞) = ‚àö2/2 ‚âà 0.7071',
            '–∫–æ—Å–∏–Ω—É—Å 60': 'cos(60¬∞) = 1/2 = 0.5',
            '–∫–æ—Å–∏–Ω—É—Å 90': 'cos(90¬∞) = 0',
            '—Ç–∞–Ω–≥–µ–Ω—Å 45': 'tan(45¬∞) = 1',
            
            // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
            '–ø–∏': 'œÄ ‚âà 3.141592653589793',
            '—á–∏—Å–ª–æ –µ': 'e ‚âà 2.718281828459045',
            '–∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ': 'œÜ ‚âà 1.618033988749895',
            '–≥—Ä–∞–¥—É—Å –≤ —Ä–∞–¥–∏–∞–Ω—ã': '1¬∞ = œÄ/180 ‚âà 0.01745 —Ä–∞–¥',
            '—Ä–∞–¥–∏–∞–Ω –≤ –≥—Ä–∞–¥—É—Å—ã': '1 —Ä–∞–¥ = 180/œÄ ‚âà 57.2958¬∞',
            
            // –§–∞–∫—Ç–æ—Ä–∏–∞–ª—ã
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 5': '5! = 5 √ó 4 √ó 3 √ó 2 √ó 1 = 120',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 6': '6! = 6 √ó 5 √ó 4 √ó 3 √ó 2 √ó 1 = 720',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 7': '7! = 7 √ó 6 √ó 5 √ó 4 √ó 3 √ó 2 √ó 1 = 5040',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 4': '4! = 4 √ó 3 √ó 2 √ó 1 = 24',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 3': '3! = 3 √ó 2 √ó 1 = 6',
            
            // –°—Ç–µ–ø–µ–Ω–∏ –¥–≤–æ–π–∫–∏
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 10': '2¬π‚Å∞ = 1024',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 8': '2‚Å∏ = 256',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 7': '2‚Å∑ = 128',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 6': '2‚Å∂ = 64',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 5': '2‚Åµ = 32',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 4': '2‚Å¥ = 16',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 3': '2¬≥ = 8',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 2': '2¬≤ = 4',
            
            // –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫–æ—Ä–Ω–∏
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 4': '‚àö4 = 2',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 9': '‚àö9 = 3',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 16': '‚àö16 = 4',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 25': '‚àö25 = 5',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 36': '‚àö36 = 6',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 49': '‚àö49 = 7',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 64': '‚àö64 = 8',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 81': '‚àö81 = 9',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 100': '‚àö100 = 10',
            
            // –õ–æ–≥–∞—Ä–∏—Ñ–º—ã
            '–ª–æ–≥–∞—Ä–∏—Ñ–º 100 –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 10': 'log‚ÇÅ‚ÇÄ(100) = 2',
            '–ª–æ–≥–∞—Ä–∏—Ñ–º 1000 –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 10': 'log‚ÇÅ‚ÇÄ(1000) = 3',
            '–ª–æ–≥–∞—Ä–∏—Ñ–º 1 –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 10': 'log‚ÇÅ‚ÇÄ(1) = 0',
            '–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –ª–æ–≥–∞—Ä–∏—Ñ–º e': 'ln(e) = 1',
            '–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –ª–æ–≥–∞—Ä–∏—Ñ–º 1': 'ln(1) = 0',
            
            // –®—É—Ç–∫–∏
            '–æ—Ç–≤–µ—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã': '42 (–ø–æ –≤–µ—Ä—Å–∏–∏ "–ê–≤—Ç–æ—Å—Ç–æ–ø–æ–º –ø–æ –≥–∞–ª–∞–∫—Ç–∏–∫–µ")',
            '–ª—É—á—à–µ–µ —á–∏—Å–ª–æ': '73 (–ø–æ –º–Ω–µ–Ω–∏—é –®–µ–ª–¥–æ–Ω–∞ –ö—É–ø–µ—Ä–∞)',
            '—Å–∞–º–æ–µ —Å—á–∞—Å—Ç–ª–∏–≤–æ–µ —á–∏—Å–ª–æ': '7',
            '—Å–∫–æ–ª—å–∫–æ –≤–µ—Å–∏—Ç —Å–ª–æ–Ω': '–ê—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —Å–ª–æ–Ω: 4000-7000 –∫–≥\n–ê–∑–∏–∞—Ç—Å–∫–∏–π —Å–ª–æ–Ω: 3000-5000 –∫–≥',
            
            // –ü–æ–º–æ—â—å
            '–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º': 'üéØ –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "="!\n\n–ü—Ä–∏–º–µ—Ä—ã:\n‚Ä¢ 100%50 ‚Üí 50 (50% –æ—Ç 100)\n‚Ä¢ 200+10% ‚Üí 220 (200 + 10%)\n‚Ä¢ x+5=10 ‚Üí —Ä–µ—à–∏—Ç —É—Ä–∞–≤–Ω–µ–Ω–∏–µ\n‚Ä¢ 3/4*2 ‚Üí –¥—Ä–æ–±–∏ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ',
            '—á—Ç–æ —É–º–µ–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä': '‚úÖ –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞\n‚úÖ –ü—Ä–æ—Ü–µ–Ω—Ç—ã\n‚úÖ –£—Ä–∞–≤–Ω–µ–Ω–∏—è\n‚úÖ –î—Ä–æ–±–∏\n‚úÖ –ù–∞—É—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\n‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü\n‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π\n‚úÖ –ü–∞–º—è—Ç—å\n\n–ò –≤—Å—ë —ç—Ç–æ –ë–ï–°–ü–õ–ê–¢–ù–û!',
            '–ø–æ–º–æ—â—å': '–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ!\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - –æ–Ω —Ä–µ–∞–ª—å–Ω–æ –∫—Ä—É—Ç–æ–π! üòâ'
        };
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü
        const unitConversions = {
            length: {
                m: 1,
                km: 0.001,
                cm: 100,
                mm: 1000,
                inch: 39.3701,
                ft: 3.28084,
                yd: 1.09361,
                mile: 0.000621371
            },
            mass: {
                kg: 1,
                g: 1000,
                mg: 1000000,
                lb: 2.20462,
                oz: 35.274,
                tonne: 0.001
            },
            temperature: {
                C: 'celsius',
                F: 'fahrenheit',
                K: 'kelvin'
            },
            area: {
                m2: 1,
                km2: 0.000001,
                ha: 0.0001,
                acre: 0.000247105,
                ft2: 10.7639
            },
            volume: {
                m3: 1,
                L: 1000,
                mL: 1000000,
                gal: 264.172,
                ft3: 35.3147
            },
            time: {
                s: 1,
                min: 1/60,
                h: 1/3600,
                day: 1/86400,
                week: 1/604800,
                year: 1/31536000
            }
        };
        
        const unitNames = {
            length: {
                m: '–ú–µ—Ç—Ä—ã',
                km: '–ö–∏–ª–æ–º–µ—Ç—Ä—ã',
                cm: '–°–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã',
                mm: '–ú–∏–ª–ª–∏–º–µ—Ç—Ä—ã',
                inch: '–î—é–π–º—ã',
                ft: '–§—É—Ç—ã',
                yd: '–Ø—Ä–¥—ã',
                mile: '–ú–∏–ª–∏'
            },
            mass: {
                kg: '–ö–∏–ª–æ–≥—Ä–∞–º–º—ã',
                g: '–ì—Ä–∞–º–º—ã',
                mg: '–ú–∏–ª–ª–∏–≥—Ä–∞–º–º—ã',
                lb: '–§—É–Ω—Ç—ã',
                oz: '–£–Ω—Ü–∏–∏',
                tonne: '–¢–æ–Ω–Ω—ã'
            },
            temperature: {
                C: '–¶–µ–ª—å—Å–∏–π',
                F: '–§–∞—Ä–µ–Ω–≥–µ–π—Ç',
                K: '–ö–µ–ª—å–≤–∏–Ω'
            }
        };
        
        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê =====
        function appendToExpression(value) {
            const input = document.getElementById('expressionInput');
            const display = document.getElementById('expressionDisplay');
            
            input.value += value;
            currentExpression = input.value;
            display.textContent = currentExpression;
            input.focus();
        }
        
        function clearExpression() {
            document.getElementById('expressionInput').value = '';
            document.getElementById('expressionDisplay').textContent = '';
            document.getElementById('resultDisplay').textContent = '0';
            currentExpression = '';
        }
        
        function calculate() {
            const input = document.getElementById('expressionInput');
            const display = document.getElementById('expressionDisplay');
            const resultDisplay = document.getElementById('resultDisplay');
            
            let expr = input.value.trim();
            currentExpression = expr;
            
            if (!expr) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ!', 'warning');
                return;
            }
            
            try {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ Samsung-style
                expr = expr.replace(/(\d+)%/g, '($1/100)');
                expr = expr.replace(/(\d+)\+(\d+)%/g, (match, num, percent) => {
                    return `${num}+${num}*${percent}/100`;
                });
                expr = expr.replace(/(\d+)-(\d+)%/g, (match, num, percent) => {
                    return `${num}-${num}*${percent}/100`;
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞
                expr = expr.replace(/(\d+)!/g, (match, num) => {
                    let fact = 1;
                    for (let i = 2; i <= parseInt(num); i++) {
                        fact *= i;
                    }
                    return fact.toString();
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏–π
                if (expr.includes('=')) {
                    const parts = expr.split('=');
                    if (parts.length === 2 && expr.includes('x')) {
                        const left = parts[0].trim();
                        const right = parts[1].trim();
                        
                        // –ü—Ä–æ—Å—Ç–æ–π –ª–∏–Ω–µ–π–Ω—ã–π —Å–ª—É—á–∞–π: x + a = b
                        if (left === 'x' || left === 'x ') {
                            const result = math.evaluate(right);
                            resultDisplay.textContent = result;
                            addToHistory(expr, result);
                            return;
                        }
                        
                        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–∏ x
                        const coeffMatch = left.match(/(\d*\.?\d*)x/);
                        if (coeffMatch) {
                            const coeff = coeffMatch[1] ? parseFloat(coeffMatch[1]) : 1;
                            const constValue = math.evaluate(right);
                            const result = constValue / coeff;
                            resultDisplay.textContent = result;
                            addToHistory(expr, result);
                            return;
                        }
                    }
                }
                
                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
                const result = math.evaluate(expr);
                resultDisplay.textContent = formatNumber(result);
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
                addToHistory(expr, result);
                
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
                input.value = '';
                display.textContent = '';
                currentExpression = '';
                
            } catch (error) {
                resultDisplay.textContent = '–û—à–∏–±–∫–∞';
                showNotification('–û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.', 'error');
                console.error('Calculation error:', error);
            }
        }
        
        function formatNumber(num) {
            if (typeof num === 'number') {
                // –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –∏–ª–∏ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —á–∏—Å–µ–ª
                if (Math.abs(num) > 1e10 || (Math.abs(num) < 1e-6 && num !== 0)) {
                    return num.toExponential(6);
                }
                
                // –î–ª—è —á–∏—Å–µ–ª —Å –¥–ª–∏–Ω–Ω–æ–π –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç—å—é
                const str = num.toString();
                if (str.includes('.') && str.split('.')[1].length > 8) {
                    return num.toFixed(8);
                }
                
                return num.toString();
            }
            return num.toString();
        }
        
        // ===== –ü–ê–ú–Ø–¢–¨ =====
        function memoryClear() {
            memoryValue = 0;
            showNotification('–ü–∞–º—è—Ç—å –æ—á–∏—â–µ–Ω–∞', 'success');
        }
        
        function memoryRecall() {
            const input = document.getElementById('expressionInput');
            input.value += memoryValue.toString();
            currentExpression = input.value;
            document.getElementById('expressionDisplay').textContent = currentExpression;
        }
        
        function memoryAdd() {
            try {
                const current = parseFloat(document.getElementById('resultDisplay').textContent) || 0;
                memoryValue += current;
                showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ø–∞–º—è—Ç—å: ${memoryValue}`, 'success');
            } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –ø–∞–º—è—Ç—å', 'error');
            }
        }
        
        function memorySubtract() {
            try {
                const current = parseFloat(document.getElementById('resultDisplay').textContent) || 0;
                memoryValue -= current;
                showNotification(`–í—ã—á—Ç–µ–Ω–æ –∏–∑ –ø–∞–º—è—Ç–∏: ${memoryValue}`, 'success');
            } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—á–∏—Ç–∞–Ω–∏–∏ –∏–∑ –ø–∞–º—è—Ç–∏', 'error');
            }
        }
        
        // ===== –ò–°–¢–û–†–ò–Ø =====
        function addToHistory(expression, result) {
            calculationHistory.push({
                expression: expression,
                result: result,
                timestamp: new Date().toLocaleTimeString()
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 –∑–∞–ø–∏—Å—è–º–∏
            if (calculationHistory.length > 50) {
                calculationHistory.shift();
            }
            
            updateHistoryDisplay();
        }
        
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; padding: 30px; color: #94a3b8;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π
            calculationHistory.slice().reverse().forEach((item, index) => {
                if (index >= 10) return;
                
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="history-expr">${item.expression}</div>
                    <div class="history-result">${formatNumber(item.result)}</div>
                    <div style="font-size: 0.8rem; color: #64748b; margin-top: 5px;">${item.timestamp}</div>
                `;
                
                div.onclick = function() {
                    document.getElementById('expressionInput').value = item.expression;
                    document.getElementById('expressionDisplay').textContent = item.expression;
                    currentExpression = item.expression;
                    showNotification('–í—ã—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏', 'success');
                };
                
                historyList.appendChild(div);
            });
        }
        
        function toggleHistory() {
            if (currentTab !== 'history') {
                showTab('history');
            } else {
                const historySection = document.getElementById('historySection');
                historySection.style.display = historySection.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        function clearAllHistory() {
            if (calculationHistory.length === 0) return;
            
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –≤—ã—á–∏—Å–ª–µ–Ω–∏–π?')) {
                calculationHistory = [];
                updateHistoryDisplay();
                showNotification('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞', 'success');
            }
        }
        
        // ===== –ö–û–ù–í–ï–†–¢–ï–† =====
        function toggleConverter() {
            if (currentTab !== 'converter') {
                showTab('converter');
            } else {
                const converterSection = document.getElementById('converterSection');
                converterSection.style.display = converterSection.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        function updateConverterUnits() {
            const category = document.getElementById('converterCategory').value;
            const fromSelect = document.getElementById('converterFrom');
            const toSelect = document.getElementById('converterTo');
            
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            
            let units = [];
            
            switch(category) {
                case 'length':
                    units = Object.keys(unitConversions.length);
                    break;
                case 'mass':
                    units = Object.keys(unitConversions.mass);
                    break;
                case 'temperature':
                    units = Object.keys(unitConversions.temperature);
                    break;
                case 'area':
                    units = Object.keys(unitConversions.area);
                    break;
                case 'volume':
                    units = Object.keys(unitConversions.volume);
                    break;
                case 'time':
                    units = Object.keys(unitConversions.time);
                    break;
            }
            
            units.forEach(unit => {
                const option1 = document.createElement('option');
                const option2 = document.createElement('option');
                
                option1.value = unit;
                option2.value = unit;
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å
                if (unitNames[category] && unitNames[category][unit]) {
                    option1.textContent = unitNames[category][unit];
                    option2.textContent = unitNames[category][unit];
                } else {
                    option1.textContent = unit;
                    option2.textContent = unit;
                }
                
                fromSelect.appendChild(option1);
                toSelect.appendChild(option2);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (units.length > 1) {
                fromSelect.value = units[0];
                toSelect.value = units[1];
            }
            
            convertUnits();
        }
        
        function convertUnits() {
            const category = document.getElementById('converterCategory').value;
            const value = parseFloat(document.getElementById('converterValue').value) || 0;
            const fromUnit = document.getElementById('converterFrom').value;
            const toUnit = document.getElementById('converterTo').value;
            const resultDiv = document.getElementById('converterResult');
            
            if (fromUnit === toUnit) {
                resultDiv.textContent = `${value} ${fromUnit} = ${value} ${toUnit}`;
                return;
            }
            
            let result;
            
            // –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
            if (category === 'temperature') {
                result = convertTemperature(value, fromUnit, toUnit);
            } else {
                // –û–±—ã—á–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
                const conversions = unitConversions[category];
                if (!conversions) {
                    resultDiv.textContent = '–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏';
                    return;
                }
                
                const valueInBase = value / conversions[fromUnit];
                result = valueInBase * conversions[toUnit];
            }
            
            resultDiv.textContent = `${value} ${fromUnit} = ${result.toFixed(6)} ${toUnit}`;
        }
        
        function convertTemperature(value, fromUnit, toUnit) {
            let celsius;
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –¶–µ–ª—å—Å–∏–π
            switch(fromUnit) {
                case 'C':
                    celsius = value;
                    break;
                case 'F':
                    celsius = (value - 32) * 5/9;
                    break;
                case 'K':
                    celsius = value - 273.15;
                    break;
                default:
                    celsius = value;
            }
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ –¶–µ–ª—å—Å–∏–π
            switch(toUnit) {
                case 'C':
                    return celsius;
                case 'F':
                    return (celsius * 9/5) + 32;
                case 'K':
                    return celsius + 273.15;
                default:
                    return celsius;
            }
        }
        
        // ===== "AI" –ü–û–ú–û–©–ù–ò–ö =====
        function askAI() {
            const prompt = document.getElementById('aiPrompt').value.trim().toLowerCase();
            const responseDiv = document.getElementById('aiResponse');
            
            if (!prompt) {
                responseDiv.innerHTML = '<div style="color: #f87171; padding: 20px; text-align: center;">–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å!</div>';
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è "–¥—É–º–∞–Ω–∏—è"
            responseDiv.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 2rem; margin-bottom: 15px;">ü§î</div>
                    <p>"–î—É–º–∞—é"...</p>
                    <div style="margin-top: 20px;">
                        <div style="width: 100%; height: 4px; background: #334155; border-radius: 2px; overflow: hidden;">
                            <div id="aiProgress" style="height: 100%; background: #8b5cf6; width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                </div>
            `;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                const progressBar = document.getElementById('aiProgress');
                if (progressBar) progressBar.style.width = `${progress}%`;
                if (progress >= 100) clearInterval(progressInterval);
            }, 100);
            
            // –ò–º–∏—Ç–∞—Ü–∏—è "–º—ã—à–ª–µ–Ω–∏—è" –ò–ò
            setTimeout(() => {
                let response = '';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                if (mathKnowledgeBase[prompt]) {
                    response = mathKnowledgeBase[prompt];
                } 
                // –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
                else {
                    const words = prompt.split(' ');
                    let found = false;
                    
                    for (const [key, value] of Object.entries(mathKnowledgeBase)) {
                        const keyLower = key.toLowerCase();
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∫–ª—é—á —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
                        if (words.some(word => word.length > 2 && keyLower.includes(word))) {
                            response = `üîç –ü–æ—Ö–æ–∂–∏–π –≤–æ–ø—Ä–æ—Å: <strong>"${key}"</strong>\n\n${value}`;
                            found = true;
                            break;
                        }
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—ã—Ç–∞–µ–º—Å—è –≤—ã—á–∏—Å–ª–∏—Ç—å –∫–∞–∫ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
                    if (!found && /[\d\+\-\*\/\^\(\)\.]/.test(prompt)) {
                        try {
                            const cleanedExpr = prompt.replace(/[^\d\+\-\*\/\^\(\)\.\s]/g, '');
                            if (cleanedExpr.trim().length >= 3) {
                                const result = math.evaluate(cleanedExpr);
                                response = `üßÆ –í—ã—á–∏—Å–ª—è—é: <strong>${cleanedExpr}</strong>\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${formatNumber(result)}`;
                                found = true;
                            }
                        } catch (e) {
                            // –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å
                        }
                    }
                    
                    // –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ –Ω–∞—à–ª–∏
                    if (!found) {
                        response = `ü§∑‚Äç‚ôÇÔ∏è <strong>"${prompt}"</strong>\n\n–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –∑–Ω–∞—é –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å.\n\nüí° –°–æ–≤–µ—Ç: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - –æ–Ω –º–æ—â–Ω—ã–π –∏ —Ä–µ—à–∏—Ç –ø–æ—á—Ç–∏ –≤—Å—ë!\n\nüé≠ P.S. –≠—Ç–æ –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–π –ò–ò, –∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π. –ù–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ!`;
                    }
                }
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
                const formattedResponse = response.replace(/\n/g, '<br>');
                
                responseDiv.innerHTML = `
                    <div style="color: #10b981; font-weight: bold; margin-bottom: 10px;">
                        ‚úÖ –û—Ç–≤–µ—Ç –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π!
                    </div>
                    <div style="font-size: 1.1rem; line-height: 1.6;">
                        ${formattedResponse}
                    </div>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; font-size: 0.9rem; color: #94a3b8;">
                        ‚ö° –û—Ç–≤–µ—Ç –∑–∞ 1 —Å–µ–∫ ‚Ä¢ üö´ –ë–µ–∑ API ‚Ä¢ üí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
                    </div>
                `;
                
            }, 1000 + Math.random() * 500); // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        }
        
        function copyAIResponse() {
            const responseDiv = document.getElementById('aiResponse');
            const text = responseDiv.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification('–û—Ç–≤–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(err => {
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'error');
            });
        }
        
        function insertAIResult() {
            const responseDiv = document.getElementById('aiResponse');
            const text = responseDiv.innerText;
            
            // –ò—â–µ–º —á–∏—Å–ª–∞ –≤ –æ—Ç–≤–µ—Ç–µ
            const numberMatch = text.match(/(?:=|—Ä–∞–≤–Ω–æ|‚Üí|is|–†–µ–∑—É–ª—å—Ç–∞—Ç:)\s*([0-9.]+)/i) || 
                               text.match(/(\d+(?:\.\d+)?)(?=\s|$)/);
            
            if (numberMatch && numberMatch[1]) {
                const number = numberMatch[1];
                document.getElementById('expressionInput').value = number;
                document.getElementById('expressionDisplay').textContent = number;
                currentExpression = number;
                closeModal('aiModal');
                showNotification(`–ß–∏—Å–ª–æ ${number} –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä`, 'success');
            } else {
                showNotification('–ù–µ –Ω–∞—à—ë–ª —á–∏—Å–ª–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏', 'warning');
            }
        }
        
        function clearAIResponse() {
            document.getElementById('aiPrompt').value = '';
            document.getElementById('aiResponse').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ü§î</div>
                    <p>"AI" –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ä–µ–∂–∏–º–µ "–ß–µ—Å—Ç–Ω—ã–π –Ω–∞—ë–±"</p>
                    <p style="margin-top: 10px; color: #94a3b8;">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å - –ø–æ–ª—É—á–∏—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π!</p>
                </div>
            `;
        }
        
        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        function showTab(tabName) {
            currentTab = tabName;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.includes(tabName === 'history' ? '–ò—Å—Ç–æ—Ä–∏—è' : '–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä')) {
                    tab.classList.add('active');
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById('historySection').style.display = tabName === 'history' ? 'block' : 'none';
            document.getElementById('converterSection').style.display = tabName === 'converter' ? 'block' : 'none';
            
            if (tabName === 'converter') {
                updateConverterUnits();
            } else if (tabName === 'history') {
                updateHistoryDisplay();
            }
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.getElementById('aiPrompt').focus();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            
            // –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };
            
            notification.textContent = message;
            notification.style.background = colors[type] || colors.info;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function handleKeyDown(event) {
            const input = document.getElementById('expressionInput');
            
            // Enter –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
            if (event.key === 'Enter') {
                calculate();
                event.preventDefault();
            }
            // Escape –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
            else if (event.key === 'Escape') {
                clearExpression();
                event.preventDefault();
            }
            // Ctrl+H –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
            else if (event.ctrlKey && event.key === 'h') {
                toggleHistory();
                event.preventDefault();
            }
            // Ctrl+C –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞
            else if (event.ctrlKey && event.key === 'c') {
                toggleConverter();
                event.preventDefault();
            }
            // Ctrl+I –¥–ª—è AI
            else if (event.ctrlKey && event.key === 'i') {
                openModal('aiModal');
                event.preventDefault();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º display –ø—Ä–∏ –≤–≤–æ–¥–µ
            setTimeout(() => {
                currentExpression = input.value;
                document.getElementById('expressionDisplay').textContent = currentExpression;
            }, 10);
        }
        
        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        window.onload = function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞
            updateConverterUnits();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            showTab('history');
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('expressionInput').focus();
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ—ë
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            };
            
            showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! üöÄ', 'success');
        };
    </script>
</body>
    </html>
