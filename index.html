<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937, #111827);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        .calculator-container {
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
        }
        .calculator {
            background: #374151;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #4b5563;
            display: flex;
            flex-direction: column;
        }
        #render-output {
            background: #1f2937;
            padding: 15px;
            border-radius: 8px;
            min-height: 60px;
            margin-bottom: 10px;
            text-align: right;
            font-size: 1.8rem;
            color: #d1d5db;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            overflow-x: auto;
        }
        #result-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
            margin-bottom: 15px;
        }
        .result-box {
            padding: 10px;
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: right;
            word-break: break-all;
            background-color: #1f2937;
            border-left: 4px solid;
        }
        .result-box.fraction-result { color: #10b981; border-color: #10b981; }
        .result-box.decimal-result { color: #3b82f6; border-color: #3b82f6; }
        .error { color: #f87171; border-color: #f87171; }
        .text-purple-400 { color: #c084fc; border-color: #c084fc; }
        .text-yellow-400 { color: #facc15; border-color: #facc15; }
        .text-orange-400 { color: #fb923c; border-color: #fb923c; }
        .converter-panel {
            background: #28303d;
            width: 100%;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #4b5563;
            margin-top: 20px;
            color: #d1d5db;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out, opacity 0.3s;
            max-height: 450px;
            overflow-y: auto;
        }
        .converter-panel.hidden {
            max-height: 0;
            padding: 0;
            opacity: 0;
            visibility: hidden;
        }
        .converter-section {
            padding: 10px;
            border: 1px solid #4b5563;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .converter-input, .converter-select {
            background: #1f2937;
            color: #d1d5db;
            border: 1px solid #4b5563;
            border-radius: 6px;
            padding: 8px;
            width: 100%;
            margin-top: 5px;
        }
        input[type="text"] {
            width: 100%;
            font-size: 1.5rem;
            margin-bottom: 15px;
            border: none;
            border-radius: 8px;
            padding: 15px;
            box-sizing: border-box;
            background: #1f2937;
            color: #d1d5db;
            text-align: right;
            transition: all 0.2s;
        }
        input[type="text"].error {
            border: 2px solid #f87171;
            box-shadow: 0 0 0 1px #f87171;
        }
        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .btn-op { background-color: #f59e0b; color: #1f2937; box-shadow: 0 3px #d97706; }
        .btn-op:active { background-color: #d97706; transform: translateY(1px); box-shadow: 0 2px #d97706; }
        .btn-num { background-color: #4b5563; color: white; box-shadow: 0 3px #374151; }
        .btn-num:active { background-color: #374151; transform: translateY(1px); box-shadow: 0 2px #374151; }
        .btn-main { background-color: #10b981; color: white; box-shadow: 0 3px #059669; grid-column: span 4; }
        .btn-main:active { background-color: #059669; transform: translateY(1px); box-shadow: 0 2px #059669; }
        .btn-clear, .btn-history { background-color: #ef4444; color: white; box-shadow: 0 3px #dc2626; }
        .btn-clear:active, .btn-history:active { background-color: #dc2626; transform: translateY(1px); box-shadow: 0 2px #dc2626; }
        .btn-mem { background-color: #3b82f6; color: white; box-shadow: 0 3px #2563eb; }
        .btn-mem:active { background-color: #2563eb; transform: translateY(1px); box-shadow: 0 2px #2563eb; }
        .btn-percent { background-color: #8b5cf6; color: white; box-shadow: 0 3px #7c3aed; }
        .btn-percent:active { background-color: #7c3aed; transform: translateY(1px); box-shadow: 0 2px #7c3aed; }
        .history-panel {
            background: #28303d;
            width: 100%;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #4b5563;
            max-height: 400px;
            overflow-y: auto;
            color: #d1d5db;
            margin-top: 20px;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out, visibility 0.3s;
        }
        .history-panel.hidden {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            visibility: hidden;
        }
        .history-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #374151;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.15s;
            border-left: 4px solid #f59e0b;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item:hover { background: #4b5563; }
        .history-content { flex: 1; }
        .history-expression { font-size: 0.9rem; color: #9ca3af; }
        .history-result { font-size: 1.2rem; font-weight: 600; color: #10b981; }
        .history-actions { display: flex; gap: 5px; }
        .history-action-btn {
            background: transparent;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 4px;
        }
        .history-action-btn:hover { background: rgba(255,255,255,0.1); }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #374151;
            padding: 20px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            color: #d1d5db;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #4b5563;
            padding-bottom: 10px;
        }
        .close-btn {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            cursor: pointer;
        }
        .close-btn:hover { color: #fff; }
        .spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
        }
        .spinner-circle {
            width: 50px;
            height: 50px;
            border: 5px solid #4b5563;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 500px;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #10b981;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .language-select {
            background: #374151;
            color: #d1d5db;
            border: 1px solid #4b5563;
            border-radius: 6px;
            padding: 5px 10px;
        }
        .precision-slider {
            width: 100%;
            height: 6px;
            background: #4b5563;
            outline: none;
            border-radius: 3px;
        }
        .precision-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        /* AI Response —Å—Ç–∏–ª–∏ */
        #ai-response {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
        }
        #ai-response code {
            background: rgba(59, 130, 246, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        #ai-response .math {
            color: #10b981;
            font-weight: bold;
        }
        #ai-response .error {
            color: #f87171;
            border-left: 3px solid #f87171;
            padding-left: 10px;
        }
        #ai-response .success {
            color: #10b981;
            border-left: 3px solid #10b981;
            padding-left: 10px;
        }
        .ai-thinking {
            animation: pulse 1.5s infinite;
            text-align: center;
            padding: 40px;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .ai-message {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3b82f6;
        }
        .ai-message.user {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: #10b981;
        }
        .ai-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .ai-action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .ai-action-btn.copy {
            background: #374151;
            color: #d1d5db;
            border: 1px solid #4b5563;
        }
        .ai-action-btn.copy:hover {
            background: #4b5563;
        }
        .ai-action-btn.insert {
            background: #059669;
            color: white;
            border: none;
        }
        .ai-action-btn.insert:hover {
            background: #047857;
        }
        .ai-action-btn.clear {
            background: #dc2626;
            color: white;
            border: none;
        }
        .ai-action-btn.clear:hover {
            background: #b91c1c;
        }
        .ai-model-select {
            background: #1f2937;
            color: #d1d5db;
            border: 1px solid #4b5563;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="spinner" id="spinner">
        <div class="spinner-circle"></div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–ø—Ä–∞–≤–∫–∏ (—Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ + –ø–æ–º–æ—â—å —Å AI) -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">üìö –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É</h2>
                <button class="close-btn" onclick="closeModal('helpModal')">√ó</button>
            </div>
            <div class="space-y-6">
                <!-- –†–∞–∑–¥–µ–ª: –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç -->
                <div>
                    <h3 class="text-lg font-bold text-blue-300 mb-3">üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
                    <p class="text-gray-300 mb-2">–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –∏ –Ω–∞–∂–º–∏—Ç–µ <kbd class="bg-gray-700 px-2 py-1 rounded">–í—ã—á–∏—Å–ª–∏—Ç—å</kbd> –∏–ª–∏ <kbd class="bg-gray-700 px-2 py-1 rounded">Enter</kbd></p>
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª: –ü—Ä–æ—Ü–µ–Ω—Ç—ã Samsung-style -->
                <div>
                    <h3 class="text-lg font-bold text-green-300 mb-2">üíØ –ü—Ä–æ—Ü–µ–Ω—Ç—ã (–∫–∞–∫ –≤ Samsung)</h3>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–§–æ—Ä–º–∞—Ç</div>
                                <code class="text-white">100%50</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                                <div class="text-green-400">50 (50% –æ—Ç 100)</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–§–æ—Ä–º–∞—Ç</div>
                                <code class="text-white">200+10%</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                                <div class="text-green-400">220 (200 + 10% –æ—Ç 200)</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–§–æ—Ä–º–∞—Ç</div>
                                <code class="text-white">500-20%</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                                <div class="text-green-400">400 (500 - 20% –æ—Ç 500)</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–§–æ—Ä–º–∞—Ç</div>
                                <code class="text-white">1000*15%</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                                <div class="text-green-400">150 (15% –æ—Ç 1000)</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–§–æ—Ä–º–∞—Ç</div>
                                <code class="text-white">80/20%</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                                <div class="text-green-400">400 (80 √∑ 20%)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª: –£—Ä–∞–≤–Ω–µ–Ω–∏—è -->
                <div>
                    <h3 class="text-lg font-bold text-purple-300 mb-2">‚öñÔ∏è –†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π</h3>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–£—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
                                <code class="text-white">x + 5 = 10</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–û—Ç–≤–µ—Ç</div>
                                <div class="text-purple-400">x = 5</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–£—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
                                <code class="text-white">2x = 8</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–û—Ç–≤–µ—Ç</div>
                                <div class="text-purple-400">x = 4</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–£—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
                                <code class="text-white">x/2 = 6</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–û—Ç–≤–µ—Ç</div>
                                <div class="text-purple-400">x = 12</div>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–£—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
                                <code class="text-white">x^2 = 9</code>
                            </div>
                            <div>
                                <div class="font-semibold text-sm text-gray-400">–û—Ç–≤–µ—Ç</div>
                                <div class="text-purple-400">x = 3 –∏–ª–∏ x = -3</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª: AI –ü–æ–º–æ—â–Ω–∏–∫ -->
                <div>
                    <h3 class="text-lg font-bold text-yellow-300 mb-2">üß† AI –ü–æ–º–æ—â–Ω–∏–∫</h3>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <div class="mb-3">
                            <h4 class="font-bold text-yellow-200 mb-2">–ß—Ç–æ –º–æ–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å —É AI:</h4>
                            <ul class="list-disc pl-5 space-y-2 text-gray-300">
                                <li><span class="text-white font-semibold">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:</span> "–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5", "—Ç–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞", "—Å–∏–Ω—É—Å 30 –≥—Ä–∞–¥—É—Å–æ–≤"</li>
                                <li><span class="text-white font-semibold">–†–∞—Å—á–µ—Ç—ã:</span> "15% –æ—Ç 200", "—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 5", "2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 10"</li>
                                <li><span class="text-white font-semibold">–§–æ—Ä–º—É–ª—ã:</span> "—Ñ–æ—Ä–º—É–ª–∞ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–∞", "—Ñ–æ—Ä–º—É–ª–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"</li>
                                <li><span class="text-white font-semibold">–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:</span> "—á–∏—Å–ª–æ –ø–∏", "–∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ", "—á–∏—Å–ª–æ e"</li>
                            </ul>
                        </div>
                        <div class="mb-3">
                            <h4 class="font-bold text-yellow-200 mb-2">–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h4>
                            <ol class="list-decimal pl-5 space-y-2 text-gray-300">
                                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <span class="text-purple-300 font-semibold">üß† AI</span> –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É</li>
                                <li>–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ</li>
                                <li>–ù–∞–∂–º–∏—Ç–µ <span class="text-green-300 font-semibold">"–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç"</span></li>
                                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤–∫–∏ —á–∏—Å–ª–∞ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</li>
                            </ol>
                        </div>
                        <div class="p-3 bg-yellow-900/30 rounded-lg border border-yellow-700">
                            <p class="text-yellow-200 text-sm font-semibold">üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é AI:</p>
                            <ul class="mt-2 space-y-1 text-sm text-yellow-100">
                                <li>‚Ä¢ –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º</li>
                                <li>‚Ä¢ AI –ø–æ–Ω–∏–º–∞–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ —Ñ–æ—Ä–º—É–ª—ã</li>
                                <li>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É <span class="bg-gray-700 px-2 py-1 rounded text-xs">‚û°Ô∏è –í—Å—Ç–∞–≤–∏—Ç—å –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span> –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</li>
                                <li>‚Ä¢ AI —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤—ã–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª: –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ -->
                <div>
                    <h3 class="text-lg font-bold text-red-300 mb-2">‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h3>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">Enter</kbd>
                                    <span class="text-gray-300">–í—ã—á–∏—Å–ª–∏—Ç—å</span>
                                </div>
                                <div class="flex items-center gap-2 mb-2">
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">Esc</kbd>
                                    <span class="text-gray-300">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</span>
                                </div>
                                <div class="flex items-center gap-2 mb-2">
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">F1</kbd>
                                    <span class="text-gray-300">–û—Ç–∫—Ä—ã—Ç—å —Å–ø—Ä–∞–≤–∫—É</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">Ctrl</kbd>
                                    <span class="text-gray-300">+</span>
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">I</kbd>
                                    <span class="text-gray-300">–û—Ç–∫—Ä—ã—Ç—å AI –ø–æ–º–æ—â–Ω–∏–∫</span>
                                </div>
                                <div class="flex items-center gap-2 mb-2">
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">‚Üë</kbd>
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">‚Üì</kbd>
                                    <span class="text-gray-300">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏—Å—Ç–æ—Ä–∏–∏</span>
                                </div>
                                <div class="flex items-center gap-2 mb-2">
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">Ctrl</kbd>
                                    <span class="text-gray-300">+</span>
                                    <kbd class="bg-gray-700 px-2 py-1 rounded text-sm">Enter</kbd>
                                    <span class="text-gray-300">–í—ã—á–∏—Å–ª–∏—Ç—å</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª: –ù–∞—É—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
                <div>
                    <h3 class="text-lg font-bold text-cyan-300 mb-2">üî¨ –ù–∞—É—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <div class="grid grid-cols-3 gap-3">
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">sin</div>
                                <div class="text-xs text-gray-400">–°–∏–Ω—É—Å —É–≥–ª–∞</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">cos</div>
                                <div class="text-xs text-gray-400">–ö–æ—Å–∏–Ω—É—Å —É–≥–ª–∞</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">tan</div>
                                <div class="text-xs text-gray-400">–¢–∞–Ω–≥–µ–Ω—Å —É–≥–ª–∞</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">log</div>
                                <div class="text-xs text-gray-400">–õ–æ–≥–∞—Ä–∏—Ñ–º</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">‚àö</div>
                                <div class="text-xs text-gray-400">–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">^</div>
                                <div class="text-xs text-gray-400">–í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">œÄ</div>
                                <div class="text-xs text-gray-400">–ß–∏—Å–ª–æ –ü–∏ (3.1415...)</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">=</div>
                                <div class="text-xs text-gray-400">–ó–Ω–∞–∫ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-sm text-gray-400">–ö–Ω–æ–ø–∫–∞</div>
                                <div class="text-cyan-400 font-bold">( )</div>
                                <div class="text-xs text-gray-400">–°–∫–æ–±–∫–∏</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª: –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü -->
                <div>
                    <h3 class="text-lg font-bold text-pink-300 mb-2">üåê –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü</h3>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <p class="text-gray-300 mb-3">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <span class="text-yellow-300">üåê</span> –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞.</p>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="text-center p-3 bg-gray-900 rounded-lg">
                                <div class="font-bold text-pink-400">–î–ª–∏–Ω–∞</div>
                                <div class="text-xs text-gray-400 mt-1">–º, –∫–º, —Å–º, –º–º, –¥—é–π–º—ã, —Ñ—É—Ç—ã, –º–∏–ª–∏</div>
                            </div>
                            <div class="text-center p-3 bg-gray-900 rounded-lg">
                                <div class="font-bold text-pink-400">–ú–∞—Å—Å–∞</div>
                                <div class="text-xs text-gray-400 mt-1">–∫–≥, –≥, –º–≥, —Ñ—É–Ω—Ç—ã, —É–Ω—Ü–∏–∏, —Ç–æ–Ω–Ω—ã</div>
                            </div>
                            <div class="text-center p-3 bg-gray-900 rounded-lg">
                                <div class="font-bold text-pink-400">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                                <div class="text-xs text-gray-400 mt-1">¬∞C, ¬∞F, K</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è -->
            <div class="mt-6 pt-4 border-t border-gray-600 text-center">
                <button onclick="closeModal('helpModal')" class="px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600">
                    –ó–∞–∫—Ä—ã—Ç—å —Å–ø—Ä–∞–≤–∫—É
                </button>
            </div>
        </div>
    </div>
    
    <!-- AI –ú–æ–¥–∞–ª–∫–∞ -->
    <div class="modal" id="aiModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold" id="ai-title">üß† AI –ü–æ–º–æ—â–Ω–∏–∫</h2>
                <button class="close-btn" onclick="closeModal('aiModal')">√ó</button>
            </div>
            
            <div class="mb-4">
                <label class="block mb-2" for="ai-prompt">–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ:</label>
                <textarea id="ai-prompt" class="w-full p-3 rounded bg-gray-800 text-white h-32" 
                          placeholder="–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 2+2
‚Ä¢ x+5=10  
‚Ä¢ 15% –æ—Ç 200
‚Ä¢ –ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5
‚Ä¢ —Ç–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞"></textarea>
            </div>
            
            <div class="mb-4 flex items-center gap-4">
                <select id="ai-model" class="ai-model-select">
                    <option>ü§ñ –†–µ–∂–∏–º: –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π</option>
                </select>
                <button onclick="askAI()" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 flex items-center gap-2" id="ai-ask-btn">
                    <span id="ai-btn-text">–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç</span>
                    <span id="ai-loading" class="hidden">‚è≥</span>
                </button>
            </div>
            
            <div id="ai-response" class="p-4 bg-gray-900 rounded min-h-48">
                <div class="ai-thinking">
                    <div class="text-2xl mb-2">ü§î</div>
                    <p>AI –ø–æ–º–æ—â–Ω–∏–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</p>
                    <p class="text-sm text-gray-400 mt-2">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å - –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç!</p>
                </div>
            </div>
            
            <div class="ai-actions mt-4">
                <button onclick="copyAIResponse()" class="ai-action-btn copy" id="ai-copy-btn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="insertAIResult()" class="ai-action-btn insert" id="ai-insert-btn">‚û°Ô∏è –í—Å—Ç–∞–≤–∏—Ç—å –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
                <button onclick="clearAIResponse()" class="ai-action-btn clear" id="ai-clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            
            <div class="mt-4 text-xs text-gray-400 text-center">
                <p>üí° –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é AI? –û—Ç–∫—Ä–æ–π—Ç–µ —Å–ø—Ä–∞–≤–∫—É (<kbd class="bg-gray-700 px-1 py-0.5 rounded">F1</kbd>)</p>
            </div>
        </div>
    </div>
    
    <!-- –•–µ–¥–µ—Ä -->
    <div class="header-controls">
        <h1 class="text-3xl font-extrabold text-white">üßÆ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
        <div class="flex gap-2">
            <button onclick="openModal('helpModal')" class="px-3 py-1 bg-blue-700 text-white rounded hover:bg-blue-600 flex items-center gap-1">
                üìö
            </button>
            <button onclick="openModal('aiModal')" class="px-3 py-1 bg-purple-700 text-white rounded hover:bg-purple-600 flex items-center gap-1">
                üß† AI
            </button>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
    <div class="calculator-container">
        <div class="calculator">
            <div id="result-container">
                <div class="result-box fraction-result" id="fraction-result">–¢–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç: –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...</div>
                <div class="result-box decimal-result" id="decimal-result">–ü—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: ---</div>
            </div>
            <div id="render-output"></div>
            <input type="text" id="expression" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: 100%50, x+5=10, 3/4*2" autocomplete="off">
            
            <!-- –ö–Ω–æ–ø–∫–∏ –ø–∞–º—è—Ç–∏ -->
            <div class="grid grid-cols-4 gap-2 mb-4">
                <button class="btn-mem text-sm" onclick="memoryClear()">MC</button>
                <button class="btn-mem text-sm" onclick="memoryRecall()">MR</button>
                <button class="btn-mem text-sm" onclick="memoryAdd()">M+</button>
                <button class="btn-mem text-sm" onclick="memorySubtract()">M-</button>
            </div>
            
            <!-- –ù–∞—É—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
            <div class="grid grid-cols-5 gap-2 mb-4">
                <button class="btn-op text-sm" onclick="appendToExpression('sin(')">sin</button>
                <button class="btn-op text-sm" onclick="appendToExpression('cos(')">cos</button>
                <button class="btn-op text-sm" onclick="appendToExpression('tan(')">tan</button>
                <button class="btn-op text-sm" onclick="appendToExpression('log(')">log</button>
                <button class="btn-op text-sm" onclick="appendToExpression('sqrt(')">‚àö</button>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ -->
            <div class="btn-grid">
                <button class="btn-history" onclick="toggleConverter()">üåê</button>
                <button class="btn-history" onclick="toggleHistory()">H</button>
                <button class="btn-clear" onclick="clearExpression()">AC</button>
                <button class="btn-op" onclick="appendToExpression('(')">(</button>
                <button class="btn-op" onclick="appendToExpression(')')">)</button>
                <button class="btn-num" onclick="appendToExpression('7')">7</button>
                <button class="btn-num" onclick="appendToExpression('8')">8</button>
                <button class="btn-num" onclick="appendToExpression('9')">9</button>
                <button class="btn-op" onclick="appendToExpression('/')">/</button>
                <button class="btn-num" onclick="appendToExpression('4')">4</button>
                <button class="btn-num" onclick="appendToExpression('5')">5</button>
                <button class="btn-num" onclick="appendToExpression('6')">6</button>
                <button class="btn-op" onclick="appendToExpression('*')">√ó</button>
                <button class="btn-num" onclick="appendToExpression('1')">1</button>
                <button class="btn-num" onclick="appendToExpression('2')">2</button>
                <button class="btn-num" onclick="appendToExpression('3')">3</button>
                <button class="btn-op" onclick="appendToExpression('-')">-</button>
                <button class="btn-num" onclick="appendToExpression('0')">0</button>
                <button class="btn-num" onclick="appendToExpression('.')">.</button>
                <button class="btn-op" onclick="appendToExpression('\\pi')">œÄ</button>
                <button class="btn-percent" onclick="appendToExpression('%')">%</button>
                <button class="btn-op" onclick="appendToExpression('^')">^</button>
                <button class="btn-op" onclick="appendToExpression('=')">=</button>
                <button class="btn-main mt-4" onclick="calculate()" id="calculate-btn">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä -->
        <div class="converter-panel hidden" id="converter-panel">
            <h3 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">üåê –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –ï–¥–∏–Ω–∏—Ü</h3>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium">–í—ã–±–µ—Ä–∏—Ç–µ –ö–∞—Ç–µ–≥–æ—Ä–∏—é:</label>
                <select id="unit-category" class="converter-select" onchange="renderUnitSelector()">
                    <option value="–î–ª–∏–Ω–∞">–î–ª–∏–Ω–∞</option>
                    <option value="–ú–∞—Å—Å–∞">–ú–∞—Å—Å–∞</option>
                    <option value="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</option>
                </select>
            </div>
            <div class="converter-section">
                <label class="block mb-2 text-sm font-medium">–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                <input type="number" id="converter-input" class="converter-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ" value="1" oninput="performConversion()">
                <div class="grid grid-cols-3 gap-2 mt-4 items-center">
                    <div><label class="block text-xs font-medium text-gray-400">–ò–ó:</label><select id="unit-from" class="converter-select" onchange="performConversion()"></select></div>
                    <div class="text-center text-lg text-yellow-400 font-bold">‚Üí</div>
                    <div><label class="block text-xs font-medium text-gray-400">–í:</label><select id="unit-to" class="converter-select" onchange="performConversion()"></select></div>
                </div>
            </div>
            <div id="converter-result-output" class="result-box decimal-result mt-4">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        </div>
        
        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="history-panel hidden" id="history-panel">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold border-b border-gray-600 pb-2">–ò—Å—Ç–æ—Ä–∏—è –í—ã—á–∏—Å–ª–µ–Ω–∏–π</h3>
                <button onclick="clearAllHistory()" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="history-log">
                <p class="text-sm text-gray-500 text-center mt-4">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤–∞—à–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è</p>
            </div>
        </div>
    </div>

    <script>
        // ============ –ü–ï–†–í–ê–Ø –ß–ê–°–¢–¨: –†–ê–ë–û–ß–ò–ô –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† ============
        
        // ===== –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        const expressionInput = document.getElementById('expression');
        const fractionResultDiv = document.getElementById('fraction-result');
        const decimalResultDiv = document.getElementById('decimal-result');
        const historyPanel = document.getElementById('history-panel');
        const historyLogDiv = document.getElementById('history-log');
        const renderOutputDiv = document.getElementById('render-output');
        const converterPanel = document.getElementById('converter-panel');
        const converterResultOutput = document.getElementById('converter-result-output');
        
        let calculationHistory = [];
        let memoryValue = 0;
        let precision = 6;
        
        const UNIT_CATEGORIES = {
            '–î–ª–∏–Ω–∞': ['m', 'km', 'cm', 'mm', 'inch', 'ft', 'yd', 'mile'],
            '–ú–∞—Å—Å–∞': ['kg', 'g', 'mg', 'lbm', 'oz', 'tonne'],
            '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞': ['degC', 'degF', 'K']
        };
        
        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê =====
        
        function init() {
            renderUnitSelector();
            loadHistory();
            setupKeyboardShortcuts();
        }
        
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // F1 –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ø—Ä–∞–≤–∫–∏
                if (e.key === 'F1') {
                    e.preventDefault();
                    openModal('helpModal');
                }
                // Ctrl+I –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è AI
                else if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    openModal('aiModal');
                }
                // Enter –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
                else if (e.key === 'Enter') {
                    calculate();
                }
                // Escape –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
                else if (e.key === 'Escape') {
                    clearExpression();
                }
                // Ctrl+Enter –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
                else if (e.ctrlKey && e.key === 'Enter') {
                    calculate();
                }
                // –°—Ç—Ä–µ–ª–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
                else if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    navigateHistory(e.key === 'ArrowUp' ? -1 : 1);
                }
            });
        }
        
        let historyIndex = -1;
        let originalExpression = '';
        
        function navigateHistory(direction) {
            if (calculationHistory.length === 0) return;
            
            if (historyIndex === -1 && direction === -1) {
                historyIndex = calculationHistory.length - 1;
                originalExpression = expressionInput.value;
            } else {
                historyIndex += direction;
                if (historyIndex < 0) historyIndex = 0;
                if (historyIndex >= calculationHistory.length) historyIndex = calculationHistory.length - 1;
            }
            
            if (historyIndex >= 0 && historyIndex < calculationHistory.length) {
                const historyItem = calculationHistory[historyIndex];
                expressionInput.value = historyItem.expression;
                renderExpression(historyItem.expression);
            }
            
            if (historyIndex >= calculationHistory.length - 1 && direction === 1) {
                historyIndex = -1;
                expressionInput.value = originalExpression;
                renderExpression(originalExpression);
            }
        }
        
        function appendToExpression(value) {
            expressionInput.value += value;
            renderExpression(expressionInput.value);
        }
        
        function clearExpression() {
            expressionInput.value = '';
            fractionResultDiv.textContent = '–¢–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç: –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...';
            decimalResultDiv.textContent = '–ü—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: ---';
            renderOutputDiv.innerHTML = '';
            historyIndex = -1;
        }
        
        function renderExpression(text) {
            renderOutputDiv.textContent = text;
        }
        
        // ===== –ö–û–†–†–ï–ö–¢–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –ü–†–û–¶–ï–ù–¢–û–í =====
        function preprocessExpression(expr) {
            expr = expr.replace(/\s+/g, '');
            
            // 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ Samsung-style
            expr = processPercentages(expr);
            
            // 2. –ó–∞–º–µ–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å math.js
            expr = expr.replace(/pi/g, 'pi');
            expr = expr.replace(/\^/g, '**');
            
            // 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—è–≤–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è
            expr = addImplicitMultiplication(expr);
            
            return expr;
        }
        
        function processPercentages(expr) {
            let result = expr;
            
            // X%Y ‚Üí X% –æ—Ç Y (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50%100 ‚Üí 50)
            result = result.replace(/(\d+(?:\.\d+)?)%(\d+(?:\.\d+)?)/g, (match, percent, number) => {
                return `(${percent}/100)*${number}`;
            });
            
            // X+Y% ‚Üí X + (X * Y/100)
            result = result.replace(/(\d+(?:\.\d+)?)\+(\d+(?:\.\d+)?)%/g, (match, num, percent) => {
                return `${num}+(${num}*${percent}/100)`;
            });
            
            // X-Y% ‚Üí X - (X * Y/100)
            result = result.replace(/(\d+(?:\.\d+)?)-(\d+(?:\.\d+)?)%/g, (match, num, percent) => {
                return `${num}-(${num}*${percent}/100)`;
            });
            
            // X*Y% ‚Üí X * (Y/100)
            result = result.replace(/(\d+(?:\.\d+)?)\*(\d+(?:\.\d+)?)%/g, (match, num, percent) => {
                return `${num}*(${percent}/100)`;
            });
            
            // X/Y% ‚Üí X / (Y/100)
            result = result.replace(/(\d+(?:\.\d+)?)\/(\d+(?:\.\d+)?)%/g, (match, num, percent) => {
                return `${num}/(${percent}/100)`;
            });
            
            // –û–¥–∏–Ω–æ—á–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤ –∫–æ–Ω—Ü–µ ‚Üí /100
            result = result.replace(/(\d+(?:\.\d+)?)%$/g, (match, num) => {
                return `(${num}/100)`;
            });
            
            return result;
        }
        
        function addImplicitMultiplication(expr) {
            // –î–æ–±–∞–≤–ª—è–µ–º * –º–µ–∂–¥—É —á–∏—Å–ª–æ–º –∏ —Å–∫–æ–±–∫–æ–π –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–µ–π
            expr = expr.replace(/(\d)([a-zA-Z(])/g, '$1*$2');
            expr = expr.replace(/([a-zA-Z)])(\d)/g, '$1*$2');
            expr = expr.replace(/\)\(/g, ')*(');
            expr = expr.replace(/([a-zA-Z)])([a-zA-Z(])/g, '$1*$2');
            
            return expr;
        }
        
        // ===== –û–ë–†–ê–ë–û–¢–ö–ê –£–†–ê–í–ù–ï–ù–ò–ô =====
        function solveEquation(equation) {
            equation = equation.replace(/\s+/g, '');
            const parts = equation.split('=');
            
            if (parts.length !== 2) return null;
            
            const left = parts[0];
            const right = parts[1];
            
            // –ü—Ä–æ—Å—Ç—ã–µ –ª–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
            if (left.includes('x') && !right.includes('x')) {
                // x + 5 = 10
                if (left === 'x') {
                    try {
                        const rightVal = math.evaluate(right);
                        return rightVal;
                    } catch (e) {
                        return null;
                    }
                }
                
                // 2x = 8 –∏–ª–∏ 2*x = 8
                const match = left.match(/(\d*\.?\d*)\*?x/);
                if (match) {
                    try {
                        const coeff = match[1] === '' ? 1 : parseFloat(match[1]);
                        const rightVal = math.evaluate(right);
                        return rightVal / coeff;
                    } catch (e) {
                        return null;
                    }
                }
                
                // x/2 = 6
                const divMatch = left.match(/x\/(\d+)/);
                if (divMatch) {
                    try {
                        const divisor = parseFloat(divMatch[1]);
                        const rightVal = math.evaluate(right);
                        return rightVal * divisor;
                    } catch (e) {
                        return null;
                    }
                }
            }
            
            // x^2 = 9
            const squareMatch = equation.match(/x\^2\s*=\s*(\d+)/);
            if (squareMatch) {
                const val = parseFloat(squareMatch[1]);
                const root = Math.sqrt(val);
                return [root, -root];
            }
            
            return null;
        }
        
        function calculate() {
            const expr = expressionInput.value.trim();
            if (!expr) return;
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ
                if (expr.includes('=')) {
                    const solution = solveEquation(expr);
                    
                    if (solution !== null) {
                        if (Array.isArray(solution)) {
                            const fractionText = `x = ${solution[0]}, ${solution[1]}`;
                            const decimalText = `x ‚âà ${solution[0].toFixed(6)}, ${solution[1].toFixed(6)}`;
                            showResults(fractionText, decimalText, false, 'text-purple-400');
                            recordHistory(expr, fractionText);
                        } else {
                            const fractionText = `x = ${solution}`;
                            const decimalText = `x ‚âà ${solution.toFixed(6)}`;
                            showResults(fractionText, decimalText, false, 'text-purple-400');
                            recordHistory(expr, fractionText);
                        }
                        return;
                    }
                }
                
                // –û–±—ã—á–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
                const processedExpr = preprocessExpression(expr);
                const result = math.evaluate(processedExpr);
                
                showResults(result.toString(), result.toFixed(6), false);
                recordHistory(expr, result);
                
            } catch (error) {
                showResults('–û—à–∏–±–∫–∞', '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ', true);
            }
        }
        
        function showResults(exact, approx, isError = false, specialClass = '') {
            fractionResultDiv.textContent = `–¢–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç: ${exact}`;
            decimalResultDiv.textContent = `–ü—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: ${approx}`;
            
            if (isError) {
                fractionResultDiv.className = 'result-box error';
                decimalResultDiv.className = 'result-box error';
            } else if (specialClass) {
                fractionResultDiv.className = `result-box ${specialClass}`;
                decimalResultDiv.className = 'result-box decimal-result';
            } else {
                fractionResultDiv.className = 'result-box fraction-result';
                decimalResultDiv.className = 'result-box decimal-result';
            }
        }
        
        // ===== –ö–û–ù–í–ï–†–¢–ï–† =====
        function toggleConverter() {
            converterPanel.classList.toggle('hidden');
        }
        
        function renderUnitSelector() {
            const category = document.getElementById('unit-category').value;
            const units = UNIT_CATEGORIES[category] || [];
            
            const unitFrom = document.getElementById('unit-from');
            const unitTo = document.getElementById('unit-to');
            
            unitFrom.innerHTML = '';
            unitTo.innerHTML = '';
            
            units.forEach(unit => {
                const option1 = document.createElement('option');
                option1.value = unit;
                option1.textContent = unit;
                unitFrom.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = unit;
                option2.textContent = unit;
                unitTo.appendChild(option2);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (units.length > 1) {
                unitFrom.selectedIndex = 0;
                unitTo.selectedIndex = 1;
            }
            
            performConversion();
        }
        
        function performConversion() {
            const value = parseFloat(document.getElementById('converter-input').value) || 1;
            const from = document.getElementById('unit-from').value;
            const to = document.getElementById('unit-to').value;
            const category = document.getElementById('unit-category').value;
            
            let result = value;
            
            if (category === '–î–ª–∏–Ω–∞') {
                const conversions = {
                    'm': 1,
                    'km': 0.001,
                    'cm': 100,
                    'mm': 1000,
                    'inch': 39.3701,
                    'ft': 3.28084,
                    'yd': 1.09361,
                    'mile': 0.000621371
                };
                result = value * (conversions[to] / conversions[from]);
            }
            else if (category === '–ú–∞—Å—Å–∞') {
                const conversions = {
                    'kg': 1,
                    'g': 1000,
                    'mg': 1e6,
                    'lbm': 2.20462,
                    'oz': 35.274,
                    'tonne': 0.001
                };
                result = value * (conversions[to] / conversions[from]);
            }
            else if (category === '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞') {
                let tempInC;
                if (from === 'degC') tempInC = value;
                else if (from === 'degF') tempInC = (value - 32) * 5/9;
                else if (from === 'K') tempInC = value - 273.15;
                
                if (to === 'degC') result = tempInC;
                else if (to === 'degF') result = (tempInC * 9/5) + 32;
                else if (to === 'K') result = tempInC + 273.15;
            }
            
            converterResultOutput.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.toFixed(4)} ${to}`;
        }
        
        // ===== –ò–°–¢–û–†–ò–Ø =====
        function toggleHistory() {
            historyPanel.classList.toggle('hidden');
            if (!historyPanel.classList.contains('hidden')) {
                updateHistoryDisplay();
            }
        }
        
        function recordHistory(expression, result) {
            calculationHistory.push({
                expression,
                result,
                timestamp: new Date().toLocaleTimeString()
            });
            
            if (calculationHistory.length > 50) {
                calculationHistory.shift();
            }
            
            updateHistoryDisplay();
            saveHistory();
        }
        
        function updateHistoryDisplay() {
            historyLogDiv.innerHTML = '';
            
            if (calculationHistory.length === 0) {
                historyLogDiv.innerHTML = '<p class="text-sm text-gray-500 text-center mt-4">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤–∞—à–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è</p>';
                return;
            }
            
            calculationHistory.slice().reverse().forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="history-content">
                        <div class="history-expression">${item.expression}</div>
                        <div class="history-result">${item.result}</div>
                        <div class="text-xs text-gray-500 mt-1">${item.timestamp}</div>
                    </div>
                `;
                div.onclick = () => {
                    expressionInput.value = item.expression;
                    renderExpression(item.expression);
                };
                historyLogDiv.appendChild(div);
            });
        }
        
        function clearAllHistory() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –≤—ã—á–∏—Å–ª–µ–Ω–∏–π?')) {
                calculationHistory = [];
                updateHistoryDisplay();
                localStorage.removeItem('calculatorHistory');
                showNotification('‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞');
            }
        }
        
        function saveHistory() {
            localStorage.setItem('calculatorHistory', JSON.stringify(calculationHistory));
        }
        
        function loadHistory() {
            const saved = localStorage.getItem('calculatorHistory');
            if (saved) {
                calculationHistory = JSON.parse(saved);
                updateHistoryDisplay();
            }
        }
        
        // ===== –ü–ê–ú–Ø–¢–¨ =====
        function memoryClear() {
            memoryValue = 0;
            showNotification('üß† –ü–∞–º—è—Ç—å –æ—á–∏—â–µ–Ω–∞');
        }
        
        function memoryRecall() {
            expressionInput.value = expressionInput.value + memoryValue;
            renderExpression(expressionInput.value);
        }
        
        function memoryAdd() {
            try {
                const expr = expressionInput.value.trim();
                const current = expr ? math.evaluate(preprocessExpression(expr)) : 0;
                memoryValue += current;
                showNotification(`üß† –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ø–∞–º—è—Ç—å. –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${memoryValue.toFixed(6)}`);
            } catch (e) {
                showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–º—è—Ç—å');
            }
        }
        
        function memorySubtract() {
            try {
                const expr = expressionInput.value.trim();
                const current = expr ? math.evaluate(preprocessExpression(expr)) : 0;
                memoryValue -= current;
                showNotification(`üß† –í—ã—á—Ç–µ–Ω–æ –∏–∑ –ø–∞–º—è—Ç–∏. –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${memoryValue.toFixed(6)}`);
            } catch (e) {
                showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–µ—Å—Ç—å –∏–∑ –ø–∞–º—è—Ç–∏');
            }
        }
        
        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // ============ –í–¢–û–†–ê–Ø –ß–ê–°–¢–¨: AI –ü–û–ú–û–©–ù–ò–ö ============
        
        // ===== –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô AI =====
        const mathKnowledgeBase = {
            // –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
            '2+2': '2 + 2 = 4',
            '3+3': '3 + 3 = 6',
            '4+4': '4 + 4 = 8',
            '5+5': '5 + 5 = 10',
            '10+10': '10 + 10 = 20',
            '100+100': '100 + 100 = 200',
            '1000+1000': '1000 + 1000 = 2000',
            '1+1': '1 + 1 = 2',
            
            // –í—ã—á–∏—Ç–∞–Ω–∏–µ
            '10-5': '10 - 5 = 5',
            '20-10': '20 - 10 = 10',
            '100-50': '100 - 50 = 50',
            
            // –£–º–Ω–æ–∂–µ–Ω–∏–µ
            '2*2': '2 √ó 2 = 4',
            '3*3': '3 √ó 3 = 9',
            '4*4': '4 √ó 4 = 16',
            '5*5': '5 √ó 5 = 25',
            '6*6': '6 √ó 6 = 36',
            '7*7': '7 √ó 7 = 49',
            '8*8': '8 √ó 8 = 64',
            '9*9': '9 √ó 9 = 81',
            '10*10': '10 √ó 10 = 100',
            
            // –î–µ–ª–µ–Ω–∏–µ
            '10/2': '10 √∑ 2 = 5',
            '20/4': '20 √∑ 4 = 5',
            '100/10': '100 √∑ 10 = 10',
            '1000/100': '1000 √∑ 100 = 10',
            
            // –£—Ä–∞–≤–Ω–µ–Ω–∏—è
            'x+5=10': 'x + 5 = 10\nx = 10 - 5\nx = 5',
            'x-3=7': 'x - 3 = 7\nx = 7 + 3\nx = 10',
            '2x=8': '2x = 8\nx = 8 √∑ 2\nx = 4',
            '3x=12': '3x = 12\nx = 12 √∑ 3\nx = 4',
            'x/2=6': 'x √∑ 2 = 6\nx = 6 √ó 2\nx = 12',
            'x^2=9': 'x¬≤ = 9\nx = ‚àö9\nx = 3 –∏–ª–∏ x = -3',
            'x^2=16': 'x¬≤ = 16\nx = ‚àö16\nx = 4 –∏–ª–∏ x = -4',
            'x^2=25': 'x¬≤ = 25\nx = ‚àö25\nx = 5 –∏–ª–∏ x = -5',
            
            // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
            '15% –æ—Ç 200': '15% –æ—Ç 200 = 200 √ó 0.15 = 30',
            '10% –æ—Ç 100': '10% –æ—Ç 100 = 100 √ó 0.10 = 10',
            '20% –æ—Ç 50': '20% –æ—Ç 50 = 50 √ó 0.20 = 10',
            '25% –æ—Ç 80': '25% –æ—Ç 80 = 80 √ó 0.25 = 20',
            '50% –æ—Ç 60': '50% –æ—Ç 60 = 60 √ó 0.50 = 30',
            '75% –æ—Ç 40': '75% –æ—Ç 40 = 40 √ó 0.75 = 30',
            '100% –æ—Ç 45': '100% –æ—Ç 45 = 45 √ó 1.00 = 45',
            '200% –æ—Ç 30': '200% –æ—Ç 30 = 30 √ó 2.00 = 60',
            
            // –ì–µ–æ–º–µ—Ç—Ä–∏—è
            '–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5': 'S = œÄr¬≤ = œÄ √ó 5¬≤ = 25œÄ ‚âà 78.54',
            '–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ r=3': 'S = œÄr¬≤ = œÄ √ó 3¬≤ = 9œÄ ‚âà 28.27',
            '–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ r=10': 'S = œÄr¬≤ = œÄ √ó 10¬≤ = 100œÄ ‚âà 314.16',
            '–ø–ª–æ—â–∞–¥—å –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å—Ç–æ—Ä–æ–Ω–æ–π 4': 'S = a¬≤ = 4¬≤ = 16',
            '–ø–ª–æ—â–∞–¥—å –∫–≤–∞–¥—Ä–∞—Ç–∞ a=5': 'S = a¬≤ = 5¬≤ = 25',
            '–ø–ª–æ—â–∞–¥—å –∫–≤–∞–¥—Ä–∞—Ç–∞ a=10': 'S = a¬≤ = 10¬≤ = 100',
            '–ø–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ 6x4': 'S = a √ó b = 6 √ó 4 = 24',
            '–ø–ª–æ—â–∞–¥—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ 6 –≤—ã—Å–æ—Ç–∞ 4': 'S = ¬Ω √ó –æ—Å–Ω–æ–≤–∞–Ω–∏–µ √ó –≤—ã—Å–æ—Ç–∞ = ¬Ω √ó 6 √ó 4 = 12',
            '–ø–µ—Ä–∏–º–µ—Ç—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å—Ç–æ—Ä–æ–Ω–æ–π 5': 'P = 4a = 4 √ó 5 = 20',
            '–æ–±—ä–µ–º –∫—É–±–∞ —Å—Ç–æ—Ä–æ–Ω–æ–π 3': 'V = a¬≥ = 3¬≥ = 27',
            '–æ–±—ä–µ–º –∫—É–±–∞ a=2': 'V = a¬≥ = 2¬≥ = 8',
            '–æ–±—ä–µ–º –∫—É–±–∞ a=4': 'V = a¬≥ = 4¬≥ = 64',
            
            // –¢–µ–æ—Ä–µ–º—ã –∏ —Ñ–æ—Ä–º—É–ª—ã
            '—Ç–µ–æ—Ä–µ–º–∞ –ø–∏—Ñ–∞–≥–æ—Ä–∞': 'a¬≤ + b¬≤ = c¬≤\n–ì–¥–µ c - –≥–∏–ø–æ—Ç–µ–Ω—É–∑–∞, a –∏ b - –∫–∞—Ç–µ—Ç—ã',
            '—Ñ–æ—Ä–º—É–ª–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è': 'ax¬≤ + bx + c = 0\nD = b¬≤ - 4ac\nx‚ÇÅ,‚ÇÇ = (-b ¬± ‚àöD) / 2a',
            '—Ñ–æ—Ä–º—É–ª–∞ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–∞': 'D = b¬≤ - 4ac',
            '—Å–∏–Ω—É—Å 30': 'sin(30¬∞) = 1/2 = 0.5',
            '—Å–∏–Ω—É—Å 45': 'sin(45¬∞) = ‚àö2/2 ‚âà 0.7071',
            '—Å–∏–Ω—É—Å 60': 'sin(60¬∞) = ‚àö3/2 ‚âà 0.8660',
            '—Å–∏–Ω—É—Å 90': 'sin(90¬∞) = 1',
            '–∫–æ—Å–∏–Ω—É—Å 30': 'cos(30¬∞) = ‚àö3/2 ‚âà 0.8660',
            '–∫–æ—Å–∏–Ω—É—Å 45': 'cos(45¬∞) = ‚àö2/2 ‚âà 0.7071',
            '–∫–æ—Å–∏–Ω—É—Å 60': 'cos(60¬∞) = 1/2 = 0.5',
            '–∫–æ—Å–∏–Ω—É—Å 90': 'cos(90¬∞) = 0',
            '—Ç–∞–Ω–≥–µ–Ω—Å 45': 'tan(45¬∞) = 1',
            
            // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
            '–ø–∏': 'œÄ ‚âà 3.141592653589793',
            '—á–∏—Å–ª–æ –µ': 'e ‚âà 2.718281828459045',
            '–∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ': 'œÜ ‚âà 1.618033988749895',
            '–≥—Ä–∞–¥—É—Å –≤ —Ä–∞–¥–∏–∞–Ω—ã': '1¬∞ = œÄ/180 ‚âà 0.01745 —Ä–∞–¥',
            '—Ä–∞–¥–∏–∞–Ω –≤ –≥—Ä–∞–¥—É—Å—ã': '1 —Ä–∞–¥ = 180/œÄ ‚âà 57.2958¬∞',
            
            // –§–∞–∫—Ç–æ—Ä–∏–∞–ª—ã
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 5': '5! = 5 √ó 4 √ó 3 √ó 2 √ó 1 = 120',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 6': '6! = 6 √ó 5 √ó 4 √ó 3 √ó 2 √ó 1 = 720',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 7': '7! = 7 √ó 6 √ó 5 √ó 4 √ó 3 √ó 2 √ó 1 = 5040',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 4': '4! = 4 √ó 3 √ó 2 √ó 1 = 24',
            '—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 3': '3! = 3 √ó 2 √ó 1 = 6',
            
            // –°—Ç–µ–ø–µ–Ω–∏ –¥–≤–æ–π–∫–∏
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 10': '2¬π‚Å∞ = 1024',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 8': '2‚Å∏ = 256',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 7': '2‚Å∑ = 128',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 6': '2‚Å∂ = 64',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 5': '2‚Åµ = 32',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 4': '2‚Å¥ = 16',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 3': '2¬≥ = 8',
            '2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 2': '2¬≤ = 4',
            
            // –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫–æ—Ä–Ω–∏
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 4': '‚àö4 = 2',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 9': '‚àö9 = 3',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 16': '‚àö16 = 4',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 25': '‚àö25 = 5',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 36': '‚àö36 = 6',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 49': '‚àö49 = 7',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 64': '‚àö64 = 8',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 81': '‚àö81 = 9',
            '–∫–æ—Ä–µ–Ω—å –∏–∑ 100': '‚àö100 = 10',
            
            // –ü–æ–º–æ—â—å
            '–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º': 'üéØ –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã—á–∏—Å–ª–∏—Ç—å"!\n\n–ü—Ä–∏–º–µ—Ä—ã:\n‚Ä¢ 100%50 ‚Üí 50 (50% –æ—Ç 100)\n‚Ä¢ 200+10% ‚Üí 220 (200 + 10%)\n‚Ä¢ x+5=10 ‚Üí —Ä–µ—à–∏—Ç —É—Ä–∞–≤–Ω–µ–Ω–∏–µ\n‚Ä¢ 3/4*2 ‚Üí –¥—Ä–æ–±–∏ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ',
            '—á—Ç–æ —É–º–µ–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä': '‚úÖ –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞\n‚úÖ –ü—Ä–æ—Ü–µ–Ω—Ç—ã\n‚úÖ –£—Ä–∞–≤–Ω–µ–Ω–∏—è\n‚úÖ –î—Ä–æ–±–∏\n‚úÖ –ù–∞—É—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\n‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü\n‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π\n‚úÖ –ü–∞–º—è—Ç—å\n\n–ò –≤—Å—ë —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!',
            '–ø–æ–º–æ—â—å': '–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ!\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - –æ–Ω –º–æ—â–Ω—ã–π! üòâ',
            '–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ai': '1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üß† AI\n2. –í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å\n3. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç"\n4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –≤—Å—Ç–∞–≤–∫–∏ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä',
            '–ø—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è ai': '‚Ä¢ "–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5"\n‚Ä¢ "—Ç–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞"\n‚Ä¢ "—Å–∏–Ω—É—Å 30 –≥—Ä–∞–¥—É—Å–æ–≤"\n‚Ä¢ "15% –æ—Ç 200"\n‚Ä¢ "—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª 5"\n‚Ä¢ "—Ñ–æ—Ä–º—É–ª–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"'
        };
        
        // ===== –§–£–ù–ö–¶–ò–ò AI =====
        function askAI() {
            const prompt = document.getElementById('ai-prompt').value.trim().toLowerCase();
            
            if (!prompt) {
                alert('–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å! –ù–∞–ø—Ä–∏–º–µ—Ä: "2+2" –∏–ª–∏ "–ø–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ —Ä–∞–¥–∏—É—Å–æ–º 5"');
                return;
            }
            
            const askBtn = document.getElementById('ai-ask-btn');
            const loading = document.getElementById('ai-loading');
            const responseDiv = document.getElementById('ai-response');
            const btnText = document.getElementById('ai-btn-text');
            
            askBtn.disabled = true;
            loading.classList.remove('hidden');
            btnText.textContent = "–î—É–º–∞—é...";
            
            responseDiv.innerHTML = '<div class="ai-thinking">ü§î –î—É–º–∞—é...</div>';
            
            // –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
            setTimeout(() => {
                try {
                    let response = findInKnowledgeBase(prompt);
                    displayAIResponse(response);
                    
                } catch (error) {
                    responseDiv.innerHTML = `
                        <div class="error p-4">
                            <strong>ü§∑‚Äç‚ôÇÔ∏è –ù–µ –∑–Ω–∞—é –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ!</strong><br><br>
                            <small>–ù–æ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä!<br>
                            –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤—ã—à–µ.</small>
                        </div>
                    `;
                } finally {
                    askBtn.disabled = false;
                    loading.classList.add('hidden');
                    btnText.textContent = "–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç";
                }
            }, 800);
        }
        
        function findInKnowledgeBase(prompt) {
            // 1. –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if (mathKnowledgeBase[prompt]) {
                return `üéØ <strong>–¢–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong><br><br>${mathKnowledgeBase[prompt]}`;
            }
            
            // 2. –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
            const words = prompt.split(' ');
            for (const [key, value] of Object.entries(mathKnowledgeBase)) {
                const keyWords = key.toLowerCase().split(' ');
                const hasMatch = words.some(word => 
                    word.length > 2 && keyWords.some(kw => kw.includes(word) || word.includes(kw))
                );
                
                if (hasMatch) {
                    return `üîç <strong>–ü–æ—Ö–æ–∂–∏–π –≤–æ–ø—Ä–æ—Å "${key}":</strong><br><br>${value}`;
                }
            }
            
            // 3. –ü–æ–ø—ã—Ç–∫–∞ –≤—ã—á–∏—Å–ª–∏—Ç—å
            const mathExpr = prompt.replace(/[^0-9+\-*/.()=x^‚àöœÄ]/g, '');
            if (mathExpr.length >= 3) {
                try {
                    const processed = preprocessExpression(mathExpr.replace(/[^0-9+\-*/.()=x]/g, ''));
                    const result = math.evaluate(processed);
                    return `üßÆ <strong>–í—ã—á–∏—Å–ª—è—é "${mathExpr}":</strong><br><br>${mathExpr} = ${result}`;
                } catch (e) {
                    // –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å
                }
            }
            
            // 4. –û–±—â–∏–π —Å–æ–≤–µ—Ç
            return `ü§î <strong>"${prompt}"</strong><br><br>
            üí° <strong>–°–æ–≤–µ—Ç:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è —Ä–µ—à–µ–Ω–∏—è!<br><br>
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —É–º–µ–µ—Ç:<br>
            ‚úÖ –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏<br>
            ‚úÖ –ü—Ä–æ—Ü–µ–Ω—Ç—ã (200+10% ‚Üí 220)<br>
            ‚úÖ –£—Ä–∞–≤–Ω–µ–Ω–∏—è (x+5=10)<br>
            ‚úÖ –î—Ä–æ–±–∏ (3/4*2)<br>
            ‚úÖ –ù–∞—É—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (sin, cos, ‚àö)<br>`;
        }
        
        function displayAIResponse(response) {
            const responseDiv = document.getElementById('ai-response');
            const formattedResponse = response.replace(/\n/g, '<br>');
            
            responseDiv.innerHTML = `
                <div class="success p-4">
                    ${formattedResponse}
                    <div class="mt-4 text-xs text-gray-400">
                        ‚ö° –û—Ç–≤–µ—Ç –∑–∞ 1 —Å–µ–∫ ‚Ä¢ üéØ –¢–æ—á–Ω–æ –≤ —Ü–µ–ª—å
                    </div>
                </div>
            `;
        }
        
        function copyAIResponse() {
            const responseDiv = document.getElementById('ai-response');
            const text = responseDiv.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('ai-copy-btn');
                const original = btn.textContent;
                btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                setTimeout(() => {
                    btn.textContent = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
                }, 2000);
            });
        }
        
        function insertAIResult() {
            const responseDiv = document.getElementById('ai-response');
            const text = responseDiv.innerText;
            
            // –ò—â–µ–º —á–∏—Å–ª–∞ –≤ –æ—Ç–≤–µ—Ç–µ
            const numberMatch = text.match(/(?:=|—Ä–∞–≤–Ω–æ|‚Üí|is)\s*([0-9.]+)/i) || 
                              text.match(/(\d+(?:\.\d+)?)(?=\s|$)/);
            
            if (numberMatch && numberMatch[1]) {
                expressionInput.value = numberMatch[1];
                renderExpression(numberMatch[1]);
                closeModal('aiModal');
                showNotification(`‚úÖ –ß–∏—Å–ª–æ ${numberMatch[1]} –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä!`);
            } else {
                showNotification('üîç –ù–µ –Ω–∞—à—ë–ª —á–∏—Å–ª–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏');
            }
        }
        
        function clearAIResponse() {
            document.getElementById('ai-response').innerHTML = 
                '<div class="ai-thinking"><div class="text-2xl mb-2">ü§î</div><p>AI –ø–æ–º–æ—â–Ω–∏–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</p><p class="text-sm text-gray-400 mt-2">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å - –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç!</p></div>';
            document.getElementById('ai-prompt').value = '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        window.onload = init;
    </script>
</body>
                                    </html>
